!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var a=t();for(var n in a)("object"==typeof exports?exports:e)[n]=a[n]}}(window,(function(){return function(e){function t(t){for(var n,s,i=t[0],c=t[1],l=t[2],f=0,m=[];f<i.length;f++)s=i[f],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&m.push(o[s][0]),o[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(u&&u(t);m.length;)m.shift()();return r.push.apply(r,l||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],n=!0,i=1;i<a.length;i++){var c=a[i];0!==o[c]&&(n=!1)}n&&(r.splice(t--,1),e=s(s.s=a[0]))}return e}var n={},o={0:0},r=[];function s(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=n,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var i=window.webpackJsonp=window.webpackJsonp||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var u=c;return r.push([57,1]),a()}({57:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(42),s=a.n(r),i=a(1),l=a(47),u=a(49),f=a(7),m=a(18),d=a(50),p=a(38),h=a(25),b=a(12),y=a(15);function g(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subscriberList={}}return function(e,t,a){t&&g(e.prototype,t)}(e,[{key:"subscribe",value:function(e,t){this.subscriberList[e]=t}},{key:"sendMessage",value:function(e,t){if(Array.isArray(e)||(e=[e]),"broadcast"===e[0])this.subscriberList.forEach((function(e,a){e({type:"broadcast",message:t})}));else for(var a in this.subscriberList)e.indexOf(a)>=0&&this.subscriberList[a](t)}}]),e}());function E(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var w=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.apiPrefix="",this.token="",this.signJwk=!1}return function(e,t,a){t&&E(e.prototype,t)}(e,[{key:"setConfig",value:function(e){this.apiPrefix=e}},{key:"setToken",value:function(e){this.token=e}},{key:"setSignJwk",value:function(e){this.signJwk=e}},{key:"getConfig",value:function(e){return this.apiPrefix}},{key:"request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json; charset=utf-8";return a&&"GET"!==t?$.ajax({method:t,url:e,headers:{accept:n,"content-type":"application/json; charset=utf-8",Authorization:"Bearer "+this.token},data:JSON.stringify(a)}):$.ajax({method:t,url:e,headers:{accept:n,"content-type":"application/json; charset=utf-8",Authorization:"Bearer "+this.token}})}},{key:"requestSigned",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(n&&"GET"!==a?$.ajax({method:a,url:e,headers:{accept:"application/jwt","content-type":"application/json; charset=utf-8",Authorization:"Bearer "+this.token},data:JSON.stringify(n)}):$.ajax({method:a,url:e,headers:{accept:"application/jwt","content-type":"application/json; charset=utf-8",Authorization:"Bearer "+this.token}})).then((function(e,a,n){return"application/jwt"===n.getResponseHeader("content-type")?t.signJwk?Object(m.a)(e,t.signJwk):Promise.reject("No public key to verify signature"):Promise.reject("invalid content-type")}))}}]),e}());function S(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var k=new(function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=0,this.changeCallback=[],window.onhashchange=function(){t.changeCallback.forEach((function(e){e(t.getCurrentRoute())}))}}return function(e,t,a){t&&S(e.prototype,t)}(e,[{key:"addChangeRouteCallback",value:function(e){this.changeCallback.push(e)}},{key:"getCurrentRoute",value:function(){var e=window.location.hash;return!!e&&e.substring(1)}},{key:"addRoute",value:function(e){history.pushState({id:"state-"+this.state++},"","#"+e)}}]),e}()),C=a(13),N=a.n(C);function O(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var P=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storageType=!1}return function(e,t,a){t&&O(e.prototype,t)}(e,[{key:"setStorageType",value:function(e){if("local"===e){var t="testLocalStorage";try{localStorage.setItem(t,t),localStorage.removeItem(t),this.storageType="local"}catch(e){this.storageType="cookie"}}else this.storageType=e}},{key:"setValue",value:function(e,t){return"local"===this.storageType?localStorage.setItem(e,JSON.stringify(t)):"cookie"===this.storageType&&N.a.set(e,JSON.stringify(t))}},{key:"removeValue",value:function(e){return"local"===this.storageType?localStorage.removeItem(e):"cookie"===this.storageType&&N.a.remove(e)}},{key:"getValue",value:function(e){return"local"===this.storageType?JSON.parse(localStorage.getItem(e))||!1:"cookie"===this.storageType&&JSON.parse(N.a.get(e))||!1}}]),e}());function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=j(e);if(t){var o=j(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?R(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config},n.changeLang=n.changeLang.bind(R(n)),n}return function(e,t,a){t&&x(e.prototype,t)}(a,[{key:"changeLang",value:function(e,t){e.preventDefault(),v.sendMessage("App",{action:"lang",lang:t})}},{key:"render",value:function(){var e=this,t=[];return this.state.config.frontend.lang.forEach((function(a,n){var r="dropdown-item";i.a.language===a&&(r+=" active"),t.push(o.a.createElement("li",{key:n},o.a.createElement("a",{className:r,href:"#",onClick:function(t){return e.changeLang(t,a)}},a)))})),o.a.createElement("li",{className:"nav-item dropdown"},o.a.createElement("a",{className:"nav-link dropdown-toggle",href:"#",id:"navbarDropdown",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},i.a.t("lang")),o.a.createElement("ul",{className:"dropdown-menu","aria-labelledby":"navbarDropdown"},t))}}]),a}();function K(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var L=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,a){t&&K(e.prototype,t)}(e,[{key:"init",value:function(e){var t=this;this.refreshToken=!1,this.accessToken=!1,this.changeStatusCb=[],this.connected=!1,this.parameters={},"/"!==window.location.pathname?this.localStorageKey="hutchOidc-"+window.btoa(unescape(encodeURIComponent(window.location.pathname))).replace(/\=+$/m,""):this.localStorageKey="hutchOidc",this.refreshTimeout=!1,e&&(this.parameters.storageType=e.storageType||"none",this.parameters.responseType=e.responseType||"code",this.parameters.scope=e.scope||"",this.parameters.openidConfigUrl=e.openidConfigUrl||"",this.parameters.authUrl=e.authUrl||"",this.parameters.tokenUrl=e.tokenUrl||"",this.parameters.clientId=e.clientId||"",this.parameters.clientPassword=e.clientPassword||"",this.parameters.redirectUri=e.redirectUri||"",this.parameters.userinfoUrl=e.userinfoUrl||"",e.changeStatusCb&&this.changeStatusCb.push(e.changeStatusCb)),this.parameters.openidConfigUrl?$.ajax({type:"GET",url:this.parameters.openidConfigUrl,success:function(e){t.parameters.authUrl=e.authorization_endpoint,t.parameters.tokenUrl=e.token_endpoint,t.parameters.userinfoUrl=e.userinfo_endpoint,t.parseInitialUrl()},error:function(e){t.broadcastMessage("error")}}):this.parseInitialUrl()}},{key:"parseInitialUrl",value:function(){var e,t,a=this;if("code"===this.parameters.responseType){var n=this.getCodeFromQuery();if(n)this.getRefreshTokenFromCode(n,(function(e){e?(a.refreshToken=e.refresh_token,a.storeRefreshToken(a.refreshToken),e.access_token?(a.accessToken={access_token:e.access_token,iat:e.iat,expires_in:e.expires_in},a.storeAccessToken(a.accessToken),a.broadcastMessage("connected",a.accessToken.access_token,a.accessToken.iat+a.accessToken.expires_in),a.getConnectedProfile((function(e,t){e&&a.broadcastMessage("profile",t)})),a.refreshTokenLoop(e.refresh_token,a.accessToken.expires_in)):a.broadcastMessage("disconnected")):a.broadcastMessage("disconnected")})),window.history.pushState(null,"",document.location.href.split("?")[0]);else if((e=this.getStoredData())&&e.accessToken&&this.isTokenValid(e.accessToken)){if(this.accessToken=e.accessToken,this.broadcastMessage("connected",this.accessToken.access_token,this.accessToken.iat+this.accessToken.expires_in),this.getConnectedProfile((function(e,t){e&&a.broadcastMessage("profile",t)})),e.refreshToken){var o=new Date,r=Math.floor((1e3*(this.accessToken.iat+this.accessToken.expires_in)-o.getTime())/1e3);this.refreshTokenLoop(e.refreshToken,r)}}else e&&e.refreshToken?(this.accessToken=!1,this.refreshToken=e.refreshToken,this.executeRefreshToken(e.refreshToken,(function(t,n){t&&(a.accessToken=n,a.storeAccessToken(n),a.refreshTokenLoop(e.refreshToken,a.accessToken.expires_in),a.broadcastMessage("connected",n.access_token,n.iat+n.expires_in),a.getConnectedProfile((function(e,t){e&&a.broadcastMessage("profile",t)})))}))):this.broadcastMessage("disconnected")}else this.parameters.responseType.search("token")>-1&&((t=this.getTokenFromFragment())?(this.accessToken=t,document.location="#",this.getConnectedProfile((function(e,n){e?a.broadcastMessage("connected",t.access_token,t.iat+t.expires_in,n):a.broadcastMessage("connected",t.access_token,t.iat+t.expires_in,!1)})),this.storeAccessToken(t)):(e=this.getStoredData())&&e.accessToken&&this.isTokenValid(e.accessToken)?(this.accessToken=e.accessToken,this.broadcastMessage("connected",this.accessToken.access_token,this.accessToken.iat+this.accessToken.expires_in),this.getConnectedProfile((function(e,t){e&&a.broadcastMessage("profile",t)}))):(this.broadcastMessage("disconnected"),this.accessToken=!1)),this.parameters.responseType.search("id_token")>-1&&(id_token=this.getQueryParams(document.location.hash).id_token)}},{key:"getQueryParams",value:function(e){e=e.split("+").join(" ");var t,a={},n=/[#&]?([^=]+)=([^&]*)/g;for(t=n.exec(e);t;)a[decodeURIComponent(t[1])]=decodeURIComponent(t[2]),t=n.exec(e);return a}},{key:"getTokenFromFragment",value:function(){var e=this.getQueryParams(document.location.hash),t=new Date;return!(!e.access_token||!e.expires_in)&&{access_token:e.access_token,expires_in:e.expires_in,iat:Math.floor(t.getTime()/1e3)}}},{key:"getCodeFromQuery",value:function(){return this.getQueryParams(document.location.search.substring(1)).code||!1}},{key:"refresh",value:function(e){var t=this;"code"===this.parameters.responseType&&this.refreshToken?this.executeRefreshToken(this.refreshToken,(function(a,n){a&&(t.accessToken=n,t.storeAccessToken(n),t.refreshTokenLoop(t.refreshToken,t.accessToken.expires_in),t.broadcastMessage("refresh",n.access_token,n.iat+n.expires_in),e(n.access_token))})):e(!1)}},{key:"getToken",value:function(){return this.accessToken&&this.isTokenValid(this.accessToken)?this.accessToken.access_token:(this.accessToken=!1,!1)}},{key:"getStatus",value:function(){return this.accessToken&&this.isTokenValid(this.accessToken)?"connected":(this.accessToken=!1,"disconnected")}},{key:"storeAccessToken",value:function(e){var t=this.getStoredData();return t||(t={}),t.accessToken=e,"local"===this.parameters.storageType?localStorage.setItem(this.localStorageKey,JSON.stringify(t)):"cookie"===this.parameters.storageType&&N.a.set(this.localStorageKey,JSON.stringify(t))}},{key:"storeIDToken",value:function(e){var t=this.getStoredData();return t||(t={}),t.IDToken=e,"local"===this.parameters.storageType?localStorage.setItem(this.localStorageKey,JSON.stringify(t)):"cookie"===this.parameters.storageType&&N.a.set(this.localStorageKey,JSON.stringify(t))}},{key:"storeRefreshToken",value:function(e){var t=this.getStoredData();return t||(t={}),t.refreshToken=e,"local"===this.parameters.storageType?localStorage.setItem(this.localStorageKey,JSON.stringify(t)):"cookie"===this.parameters.storageType&&N.a.set(this.localStorageKey,JSON.stringify(t))}},{key:"storeNonce",value:function(e){var t=this.getStoredData();return t||(t={}),t.nonce=e,"local"===this.parameters.storageType?localStorage.setItem(this.localStorageKey,JSON.stringify(t)):"cookie"===this.parameters.storageType&&N.a.set(this.localStorageKey,JSON.stringify(t))}},{key:"makeNonce",value:function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,o=0;o<e;o++)t+=a.charAt(Math.floor(Math.random()*n));return t}},{key:"getStoredData",value:function(){return"local"===this.parameters.storageType?JSON.parse(localStorage.getItem(this.localStorageKey))||{}:"cookie"===this.parameters.storageType&&JSON.parse(N.a.get(this.localStorageKey))||{}}},{key:"onChangeStatus",value:function(e){this.changeStatusCb.push(e)}},{key:"isTokenValid",value:function(e){if(e){var t=new Date;return 1e3*(e.iat+e.expires_in)>t.getTime()}return!1}},{key:"getRefreshTokenFromCode",value:function(e,t){var a=this;$.ajax({type:"POST",url:this.parameters.tokenUrl,data:{grant_type:"authorization_code",client_id:this.parameters.clientId,redirect_uri:this.parameters.redirectUri,code:e},success:function(e,a,n){t(e)},error:function(e){403===e.status&&(a.refreshToken=!1),a.accessToken=!1,t(!1)}})}},{key:"refreshTokenLoop",value:function(e,t){var a=this;clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout((function(){a.executeRefreshToken(e,(function(t,n){if(t){var o=new Date,r=Math.floor((1e3*(n.iat+n.expires_in)-o.getTime())/1e3);a.refreshTokenLoop(e,r)}}))}),1e3*(t-60))}},{key:"runRefreshToken",value:function(e){return this.getStoredData().refreshToken?this.executeRefreshToken(this.getStoredData().refreshToken,e):new Promise((function(e,t){t("disconnected")}))}},{key:"executeRefreshToken",value:function(e,t){var a=this;return $.ajax({type:"POST",url:this.parameters.tokenUrl,data:{grant_type:"refresh_token",refresh_token:e},success:function(e,n,o){a.accessToken=e.access_token,a.storeAccessToken(e),a.broadcastMessage("refresh",e.access_token,e.iat+e.expires_in),t&&t(!0,e)},error:function(e){403===e.status&&(a.refreshToken=!1),a.accessToken=!1,0===e.readyState?a.broadcastMessage("network error"):a.broadcastMessage("disconnected"),t&&t(!1)}}).then((function(e){return{token:e.access_token,expiration:e.expires_in}}))}},{key:"broadcastMessage",value:function(e,t,a,n){for(var o in this.changeStatusCb)this.changeStatusCb[o](e,t,a,n)}},{key:"getConnectedProfile",value:function(e){this.parameters.userinfoUrl?$.ajax({type:"GET",url:this.parameters.userinfoUrl,headers:{Authorization:"Bearer "+this.accessToken.access_token},success:function(t){e&&e(!0,t)},error:function(t){e&&e(!1)}}):e(!1)}},{key:"connect",value:function(){var e=this,t=this.getStoredData();if(t&&this.isTokenValid(t.accessToken))this.broadcastMessage("connected",t.accessToken.access_token,t.accessToken.iat+t.accessToken.expires_in),this.getConnectedProfile((function(t,a){t&&e.broadcastMessage("profile",a)}));else{t.accessToken=!1;var a=this.makeNonce(16);this.storeAccessToken(!1),this.storeNonce(a),"token"===this.parameters.responseType?document.location=this.parameters.authUrl+"?response_type=token&client_id="+this.parameters.clientId+"&redirect_uri="+this.parameters.redirectUri+"&scope="+this.parameters.scope+"&nonce="+a:"code"===this.parameters.responseType&&(document.location=this.parameters.authUrl+"?response_type=code&client_id="+this.parameters.clientId+"&redirect_uri="+this.parameters.redirectUri+"&scope="+this.parameters.scope+"&nonce="+a)}}},{key:"disconnect",value:function(){clearTimeout(this.refreshTimeout),"local"===this.parameters.storageType?localStorage.removeItem(this.localStorageKey):"cookie"===this.parameters.storageType&&N.a.remove(this.localStorageKey),this.refreshToken=!1,this.accessToken=!1,this.broadcastMessage("disconnected")}}]),e}());function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=F(e);if(t){var o=F(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==M(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={status:e.status},n}return function(e,t,a){t&&I(e.prototype,t),a&&I(e,a)}(a,[{key:"logOut",value:function(){L.disconnect()}},{key:"logIn",value:function(){L.connect()}},{key:"render",value:function(){return"connecting"===this.state.status?o.a.createElement("a",{className:"nav-link",onClick:this.logIn,href:"#"},i.a.t("connecting")):"connected"===this.state.status?o.a.createElement("a",{className:"nav-link",onClick:this.logOut,href:"#"},i.a.t("log_out")):o.a.createElement("a",{className:"nav-link",onClick:this.logIn,href:"#"},i.a.t("log_in"))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=G(e);if(t){var o=G(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==U(t)&&"function"!=typeof t?V(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,oidcStatus:e.oidcStatus,safeList:e.safeList},n.navigateTo=n.navigateTo.bind(V(n)),n.addSafe=n.addSafe.bind(V(n)),n}return function(e,t,a){t&&W(e.prototype,t),a&&W(e,a)}(a,[{key:"navigateTo",value:function(e,t){e.preventDefault(),k.addRoute(t||""),v.sendMessage("App",{action:"nav",target:t})}},{key:"addSafe",value:function(e){e.preventDefault(),v.sendMessage("App",{action:"addSafe"})}},{key:"render",value:function(){var e,t=this,a=[];return this.state.safeList.forEach((function(e,n){a.push(o.a.createElement("li",{className:"nav-item",key:n},o.a.createElement("a",{className:"nav-link active","data-bs-toggle":"collapse","data-bs-target":".navbar-collapse.show",href:"#","aria-current":"page",onClick:function(a){return t.navigateTo(a,e.name)}},e.display_name||e.name)))})),"connected"===this.state.oidcStatus&&(e=o.a.createElement("li",{className:"nav-item"},o.a.createElement("a",{className:"nav-link active","data-bs-toggle":"collapse","data-bs-target":".navbar-collapse.show","aria-current":"page",href:"#",onClick:this.addSafe},i.a.t("addSafe")))),o.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light"},o.a.createElement("div",{className:"container-fluid"},o.a.createElement("a",{className:"navbar-brand",href:"#",onClick:function(e){return t.navigateTo(e,!1)}},"Hutch"),o.a.createElement("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},o.a.createElement("span",{className:"navbar-toggler-icon"})),o.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarNav"},o.a.createElement("ul",{className:"navbar-nav"},o.a.createElement("li",{className:"nav-item"},o.a.createElement("a",{className:"nav-link active","data-bs-toggle":"collapse","data-bs-target":".navbar-collapse.show","aria-current":"page",href:"#",onClick:function(e){return t.navigateTo(e,!1)}},i.a.t("profile"))),a,e),o.a.createElement("ul",{className:"navbar-nav ms-auto flex-nowrap text-right"},o.a.createElement(D,{config:this.state.config}),o.a.createElement("li",{className:"nav-item"},o.a.createElement(B,{status:this.state.oidcStatus}))))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Y(e);if(t){var o=Y(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==H(t)&&"function"!=typeof t?X(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={name:e.name,title:e.title,message:e.message,cb:e.cb},n.closeModal=n.closeModal.bind(X(n)),n}return function(e,t,a){t&&Q(e.prototype,t),a&&Q(e,a)}(a,[{key:"closeModal",value:function(e,t){this.state.cb&&this.state.cb(t)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"modal",tabIndex:"-1",id:this.state.name},o.a.createElement("div",{className:"modal-dialog"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"modal-header"},o.a.createElement("h5",{className:"modal-title"},this.state.title),o.a.createElement("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:function(t){return e.closeModal(t,!1)}})),o.a.createElement("div",{className:"modal-body"},o.a.createElement("p",null,this.state.message)),o.a.createElement("div",{className:"modal-footer"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.closeModal(t,!1)}},i.a.t("modalClose")),o.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.closeModal(t,!0)}},i.a.t("modalOk"))))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function ee(e){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function te(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=oe(e);if(t){var o=oe(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==ee(t)&&"function"!=typeof t?ne(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,hutchProfile:e.hutchProfile,imageError:!1,nameMandatory:!1,messageMandatory:!1,imageMandatory:!1,imageLoading:!1},n.editProfile=n.editProfile.bind(ne(n)),n.cancelEditProfile=n.cancelEditProfile.bind(ne(n)),n.editKey=n.editKey.bind(ne(n)),n.editMessage=n.editMessage.bind(ne(n)),n.getRandomWikimediaImage=n.getRandomWikimediaImage.bind(ne(n)),n.uploadImage=n.uploadImage.bind(ne(n)),n.onUploadImage=n.onUploadImage.bind(ne(n)),n.saveProfile=n.saveProfile.bind(ne(n)),n.removeProfile=n.removeProfile.bind(ne(n)),n.removeProfileConfirm=n.removeProfileConfirm.bind(ne(n)),n}return function(e,t,a){t&&te(e.prototype,t),a&&te(e,a)}(a,[{key:"editProfile",value:function(){var e=this.state.hutchProfile;e.name||(e.name=this.state.profile.name),e.sign_kid||(e.sign_kid=this.state.config.jwks.keys[0].kid),this.setState({editProfile:!0,hutchProfile:e})}},{key:"cancelEditProfile",value:function(){v.sendMessage("App",{action:"getProfile"})}},{key:"editKey",value:function(e){var t=this.state.hutchProfile;t.sign_kid=e.target.value,this.setState({hutchProfile:t})}},{key:"editMessage",value:function(e){var t=this.state.hutchProfile;t.message=e.target.value,this.setState({hutchProfile:t})}},{key:"editName",value:function(e){var t=this.state.hutchProfile;t.name=e.target.value,this.setState({hutchProfile:t})}},{key:"getRandomWikimediaImage",value:function(){var e=this;this.setState({imageLoading:!0},(function(){$.ajax({url:"https://commons.wikimedia.org/w/api.php?action=query&list=random&rnnamespace=6&rnlimit=1&prop=imageinfo&format=json&origin=*"}).then((function(t){$.ajax({url:"https://commons.wikimedia.org/w/api.php?action=query&prop=imageinfo&iiprop=url&iiurlwidth=200&format=json&origin=*&titles="+t.query.random[0].title}).then((function(a){var n=new XMLHttpRequest;n.open("GET",a.query.pages[t.query.random[0].id].imageinfo[0].responsiveUrls[1.5],!0),n.responseType="arraybuffer",n.onload=function(t){n.response;var a=e.state.hutchProfile;a.picture="data:"+n.getResponseHeader("content-type")+";base64,"+btoa(String.fromCharCode.apply(null,new Uint8Array(n.response))),e.setState({hutchProfile:a,imageError:!1,imageLoading:!1})},n.send(null)})).fail((function(){$.snack("warning",i.a.t("messageErrorWikiImage")),e.setState({imageError:!0,imageLoading:!1})}))})).fail((function(){$.snack("warning",i.a.t("messageErrorWikiImage")),e.setState({imageError:!0,imageLoading:!1})}))}))}},{key:"uploadImage",value:function(){$("#uploadImageInput").trigger("click")}},{key:"onUploadImage",value:function(e){var t=this,a=e.target.files;if(a.length>0){var n=a[0];if(n.size>409600)this.setState({imageError:!0});else{var o=new FileReader;o.onload=function(e){var a=t.state.hutchProfile;a.picture=e.target.result,t.setState({hutchProfile:a,imageError:!1})},o.readAsDataURL(n)}}}},{key:"saveProfile",value:function(e){e.preventDefault();var t=this.state.hutchProfile;t.message&&t.name&&t.picture?w.request(this.state.config.profile_endpoint,"PUT",t).then((function(){v.sendMessage("App",{action:"getProfile"}),$.snack("info",i.a.t("messageProfileSaved"))})).fail((function(){$.snack("warning",i.a.t("messageErrorSaveProfile"))})):this.setState({messageMandatory:!t.message,nameMandatory:!t.name,imageMandatory:!t.picture})}},{key:"removeProfile",value:function(){new bootstrap.Modal(document.getElementById("removeProfile"),{keyboard:!1}).show()}},{key:"removeProfileConfirm",value:function(e){e&&w.request(this.state.config.profile_endpoint,"DELETE").then((function(){v.sendMessage("App",{action:"resetProfile"}),$.snack("info",i.a.t("messageRemoveProfile"))})).fail((function(){$.snack("warning",i.a.t("messageErrorSaveProfile"))})),bootstrap.Modal.getOrCreateInstance(document.querySelector("#removeProfile")).hide()}},{key:"render",value:function(){var e,t,a,n,r=this,s=[];this.state.config.jwks.keys.forEach((function(e,t){s.push(o.a.createElement("option",{value:e.kid,key:t},e.alg))})),this.state.imageLoading?e=c:this.state.hutchProfile.picture&&(e=o.a.createElement("img",{src:this.state.hutchProfile.picture,alt:"profile image",className:"profile-image"}));var l="form-control";this.state.messageMandatory&&(l+=" is-invalid",a=o.a.createElement("div",{className:"invalid-feedback"},i.a.t("profileMessageMandatory")));var u="form-control";return this.state.nameMandatory&&(u+=" is-invalid",n=o.a.createElement("div",{className:"invalid-feedback"},i.a.t("profileNameMandatory"))),this.state.imageMandatory&&(t=o.a.createElement("div",{className:"alert alert-danger"},i.a.t("profileImageMandatory"))),o.a.createElement("div",null,o.a.createElement("form",{onSubmit:this.saveProfile},o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"keyList",className:"form-label"},i.a.t("profileServerKey")),o.a.createElement("select",{className:"form-select","aria-label":"public key",id:"keyList",onChange:function(e){return r.editKey(e)},value:this.state.hutchProfile.sign_kid},s)),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"profileName",className:"form-label"},i.a.t("profileName")),o.a.createElement("input",{type:"text",className:u,id:"profileName",value:this.state.hutchProfile.name||"",onChange:function(e){return r.editName(e)}}),n),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"profileMessage",className:"form-label"},i.a.t("profileMessage")),o.a.createElement("textarea",{className:l,id:"profileMessage",value:this.state.hutchProfile.message||"",onChange:function(e){return r.editMessage(e)},maxLength:"512"}),a),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{className:"form-label"},i.a.t("profileImage")),o.a.createElement("div",null,e,t)),o.a.createElement("div",{className:"mb-3"},o.a.createElement("input",{type:"file",id:"uploadImageInput",onChange:this.onUploadImage,accept:".jpg,.jpg,.png,.gif,.bmp",className:"upload"}),o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.uploadImage},i.a.t("profileImageSelect")),o.a.createElement("span",{className:"badge bg-secondary btn-icon btn-icon-right"},i.a.t("or")),o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.getRandomWikimediaImage},i.a.t("profileImageRandom"))),o.a.createElement("hr",null),o.a.createElement("div",{className:"btn-toolbar justify-content-between",role:"toolbar"},o.a.createElement("div",{className:"btn-group",role:"group"},o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:this.saveProfile},i.a.t("profileSubmit")),o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.cancelEditProfile},i.a.t("profileCancel"))),o.a.createElement("div",{className:"input-group"},o.a.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.removeProfile},o.a.createElement("i",{className:"fa fa-trash","aria-hidden":"true"}))))),o.a.createElement(Z,{name:"removeProfile",title:i.a.t("removeProfileTitle"),message:i.a.t("removeProfileMessage"),cb:this.removeProfileConfirm}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ce(e,t){return(ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ue=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=le(e);if(t){var o=le(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==se(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,profile:e.profile,hutchProfile:e.hutchProfile},n}return function(e,t,a){t&&ie(e.prototype,t),a&&ie(e,a)}(a,[{key:"editProfile",value:function(){v.sendMessage("App",{action:"editProfile"})}},{key:"lockAllSafe",value:function(){v.sendMessage("App",{action:"lockAllSafe"}),$.snack("info",i.a.t("lockedAllSafe"))}},{key:"render",value:function(){var e,t;return this.state.hutchProfile?(e=o.a.createElement("div",null,o.a.createElement("div",{className:"d-flex justify-content-center"},o.a.createElement("img",{src:this.state.hutchProfile.picture,className:"card-img-top profile-image"})),o.a.createElement("div",{className:"d-flex justify-content-center"},o.a.createElement("p",null,this.state.hutchProfile.message))),t=o.a.createElement("div",{className:"d-flex justify-content-center"},o.a.createElement("button",{type:"button",onClick:this.editProfile,className:"btn btn-secondary"},i.a.t("profileEdit")))):t=o.a.createElement("button",{type:"button",onClick:this.editProfile,className:"btn btn-secondary"},i.a.t("profileCreate")),o.a.createElement("div",null,o.a.createElement("div",{className:"alert alert-primary",role:"alert"},i.a.t("profileValue",{name:this.state.hutchProfile.name||this.state.profile.name}),o.a.createElement("div",{className:"btn-group float-end",role:"group"},o.a.createElement("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:this.lockAllSafe,title:i.a.t("lockAllSafe")},o.a.createElement("i",{className:"fa fa-lock","aria-hidden":"true"})))),e,t)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function fe(e){return(fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function me(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pe(e){return(pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var he=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=pe(e);if(t){var o=pe(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==fe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,profile:e.profile,hutchProfile:e.hutchProfile,hasProfile:e.hasProfile,editProfile:e.editProfile,oidcStatus:e.oidcStatus},n}return function(e,t,a){t&&me(e.prototype,t),a&&me(e,a)}(a,[{key:"render",value:function(){return"connecting"===this.state.oidcStatus?o.a.createElement("div",{className:"alert alert-success",role:"alert"},i.a.t("connectingMessage")):"disconnected"===this.state.oidcStatus?o.a.createElement("div",{className:"alert alert-warning",role:"alert"},i.a.t("disconnectedMessage")):this.state.editProfile?o.a.createElement(re,{config:this.state.config,hutchProfile:this.state.hutchProfile}):o.a.createElement(ue,{config:this.state.config,hutchProfile:this.state.hutchProfile,profile:this.state.profile})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ye(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Ee(e);if(t){var o=Ee(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==be(t)&&"function"!=typeof t?ve(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={isError:e.isError,errorMessage:e.errorMessage,ph:e.ph,cb:e.cb,value:"",filename:""},n.changeValue=n.changeValue.bind(ve(n)),n.getFile=n.getFile.bind(ve(n)),n}return function(e,t,a){t&&ye(e.prototype,t),a&&ye(e,a)}(a,[{key:"changeValue",value:function(e){var t=this;this.setState({value:e.target.value,filename:""},(function(){t.state.cb(t.state.value)}))}},{key:"getFile",value:function(e){var t=this,a=e.target.files[0],n=new FileReader;n.onload=function(e){t.setState({value:e.target.result,filename:a.name},(function(){t.state.cb(t.state.value)}))},n.readAsText(a)}},{key:"render",value:function(){var e,t,a=this,n="form-control";return this.state.isError&&(n+=" is-invalid",e=o.a.createElement("div",{className:"invalid-feedback"},this.state.errorMessage)),this.state.filename&&(t=o.a.createElement("code",{className:"btn-icon-right"},this.state.filename)),o.a.createElement("div",null,o.a.createElement("div",{className:"input-group"},o.a.createElement("textarea",{className:n,autoComplete:"off",placeholder:this.state.ph,value:this.state.filename?"":this.state.value,onChange:function(e){return a.changeValue(e)}}),o.a.createElement("input",{type:"file",className:"upload",id:"jwkFile",onChange:this.getFile}),o.a.createElement("label",{htmlFor:"jwkFile",className:"btn btn-outline-secondary btn-sm"},o.a.createElement("i",{className:"fa fa-cloud-upload","aria-hidden":"true"})),e),t)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function Se(e){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ke(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ce(e,t){return(Ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Oe(e){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ce(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Oe(e);if(t){var o=Oe(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Se(t)&&"function"!=typeof t?Ne(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={safeKey:e.safeKey,cb:e.callback,newPassword:"",confirmNewPassword:"",safeKeyJwk:"",keyName:"",pwdScore:-1,isValid:!1},n.changeNewPassword=n.changeNewPassword.bind(Ne(n)),n.changeConfirmNewPassword=n.changeConfirmNewPassword.bind(Ne(n)),n.editSafeKeyJwk=n.editSafeKeyJwk.bind(Ne(n)),n}return function(e,t,a){t&&ke(e.prototype,t),a&&ke(e,a)}(a,[{key:"changeDisplayName",value:function(e){var t=this,a=this.state.safeKey;a.display_name=e.target.value,this.setState({safeKey:a},(function(){t.isSafeKeyValid()}))}},{key:"changeNewPassword",value:function(e){var t=this,a=-1;e.target.value&&(a=zxcvbn(e.target.value).score),this.setState({newPassword:e.target.value,pwdScore:a},(function(){t.isSafeKeyValid()}))}},{key:"changeConfirmNewPassword",value:function(e){var t=this;this.setState({confirmNewPassword:e.target.value},(function(){t.isSafeKeyValid()}))}},{key:"editSafeKeyJwk",value:function(e){var t=this;this.setState({safeKeyJwk:e},(function(){t.isSafeKeyValid()}))}},{key:"isSafeKeyValid",value:function(){var e=!0;if(this.state.safeKey.display_name||(e=!1),"password"===this.state.safeKey.type)this.state.newPassword||(e=!1),this.state.newPassword!==this.state.confirmNewPassword&&(e=!1);else if("master-password"===this.state.safeKey.type)this.state.newPassword||(e=!1);else if("jwk"===this.state.safeKey.type)try{this.state.safeKeyJwk&&JSON.parse(this.state.safeKeyJwk).alg||(e=!1)}catch(t){e=!1}this.setState({isValid:e})}},{key:"saveSafe",value:function(e){e.preventDefault(),this.state.isValid&&this.closeModal(e,!0)}},{key:"closeModal",value:function(e,t){var a;try{a=JSON.parse(this.state.safeKeyJwk)}catch(e){a=!1}this.state.cb&&(this.state.cb(t,{safeKey:this.state.safeKey,password:this.state.newPassword,jwk:a}),this.setState({newPassword:"",confirmNewPassword:"",pwdScore:-1,isValid:!1}))}},{key:"render",value:function(){var e,t,a=this;if("password"===this.state.safeKey.type)0===this.state.pwdScore?e=o.a.createElement("span",{className:"badge bg-danger"},i.a.t("pwdScoreTooGuessable")):1===this.state.pwdScore?e=o.a.createElement("span",{className:"badge bg-warning"},i.a.t("pwdScoreVeryGuessable")):2===this.state.pwdScore?e=o.a.createElement("span",{className:"badge bg-secondary"},i.a.t("pwdScoreSomewhatGuessable")):3===this.state.pwdScore?e=o.a.createElement("span",{className:"badge bg-primary"},i.a.t("pwdScoreSafelyUnguessable")):4===this.state.pwdScore&&(e=o.a.createElement("span",{className:"badge bg-success"},i.a.t("pwdScoreVeryUnguessable"))),t=o.a.createElement("div",null,o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"newPassword",className:"form-label"},i.a.t("newPassword")),o.a.createElement("input",{type:"password",autoComplete:"off",className:"form-control",id:"newPassword",placeholder:i.a.t("newPasswordPh"),value:this.state.newPassword,onChange:function(e){return a.changeNewPassword(e)}}),e),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"confirmNewPassword",className:"form-label"},i.a.t("confirmNewPassword")),o.a.createElement("input",{type:"password",autoComplete:"off",className:"form-control",id:"confirmNewPassword",placeholder:i.a.t("confirmNewPasswordPh"),value:this.state.confirmNewPassword,onChange:function(e){return a.changeConfirmNewPassword(e)}})));else if("master-password"===this.state.safeKey.type)t=o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"newPassword",className:"form-label"},i.a.t("masterPassword")),o.a.createElement("input",{type:"password",autoComplete:"off",className:"form-control",id:"newPassword",placeholder:i.a.t("masterPasswordPh"),value:this.state.newPassword,onChange:function(e){return a.changeNewPassword(e)}}));else if("jwk"===this.state.safeKey.type){var n;this.state.isValid||(n=o.a.createElement("div",{className:"invalid-feedback"},i.a.t("jwkError"))),t=o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"safeKeyJwk",className:"form-label"},i.a.t("safeKeyJwk")),o.a.createElement(we,{isError:!this.state.isValid,ph:i.a.t("safeKeyJwkPh"),cb:this.editSafeKeyJwk}),n)}return o.a.createElement("div",{className:"modal",tabIndex:"-1",id:"modalSafeKey"},o.a.createElement("div",{className:"modal-dialog"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"modal-header"},o.a.createElement("h5",{className:"modal-title"},i.a.t("modalSafeKey")),o.a.createElement("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:function(e){return a.closeModal(e,!1)}})),o.a.createElement("form",{onSubmit:this.saveSafe},o.a.createElement("div",{className:"modal-body"},o.a.createElement("input",{type:"hidden",maxLength:"128",id:"safeKeyName",value:this.state.safeKey.name}),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"safeKeyDisplayName",className:"form-label"},i.a.t("safeKeyDisplayName")),o.a.createElement("input",{type:"text",maxLength:"512",className:"form-control",id:"safeKeyDisplayName",placeholder:i.a.t("safeKeyDisplayNamePh"),value:this.state.safeKey.display_name,onChange:function(e){return a.changeDisplayName(e)}})),t),o.a.createElement("div",{className:"modal-footer"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(e){return a.closeModal(e,!1)}},i.a.t("modalClose")),o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:function(e){return a.saveSafe(e)},disabled:!this.state.isValid},i.a.t("modalOk")))))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xe(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _e(e,t){return(_e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function je(e){return(je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function De(e,t){var a=!1,n="hutchsafekey-"+t.name;"/"!==window.location.pathname&&(n+="-"+window.btoa(unescape(encodeURIComponent(window.location.pathname))).replace(/\=+$/m,""));var o=P.getValue(n);return o?e[t.name]&&e[t.name].keyList&&e[t.name].keyList.forEach((function(e){e.name===o&&(a=e)})):e&&t&&e[t.name]&&e[t.name].keyList&&e[t.name].keyList.forEach((function(e){a||"password"!==e.type&&"master-password"!==e.type&&"jwk"!==e.type||(a=e)})),a}var Ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_e(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=je(e);if(t){var o=je(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Te(t)&&"function"!=typeof t?Re(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,safe:e.safe,safeContent:e.safeContent,cb:e.cb,allowKeepUnlocked:e.allowKeepUnlocked,safeKey:De(e.safeContent,e.safe),safePassword:"",safeKeyJwk:"",safeSecretError:!1,keepUnlocked:!1,unlockKeyName:n.getBrowserInfo()},n.closeModal=n.closeModal.bind(Re(n)),n.setSafeKey=n.setSafeKey.bind(Re(n)),n.toggleKeepUnlocked=n.toggleKeepUnlocked.bind(Re(n)),n.changeUnlockKeyName=n.changeUnlockKeyName.bind(Re(n)),n.editSafeKeyJwk=n.editSafeKeyJwk.bind(Re(n)),n}return function(e,t,a){t&&xe(e.prototype,t),a&&xe(e,a)}(a,[{key:"changePassword",value:function(e){this.setState({safePassword:e.target.value})}},{key:"editSafeKeyJwk",value:function(e){this.setState({safeKeyJwk:e})}},{key:"toggleKeepUnlocked",value:function(e){var t=!this.state.keepUnlocked;this.setState({keepUnlocked:t})}},{key:"changeUnlockKeyName",value:function(e){this.setState({unlockKeyName:e.target.value})}},{key:"setSafeKey",value:function(e,t){var a=this;e.preventDefault(),this.setState({safeKey:t,safeSecretError:!1},(function(){var e="hutchsafekey-"+a.state.safe.name;"/"!==window.location.pathname&&(e+="-"+window.btoa(unescape(encodeURIComponent(window.location.pathname))).replace(/\=+$/m,"")),P.setValue(e,t.name)}))}},{key:"getBrowserInfo",value:function(){var e,t=navigator.userAgent,a=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(a[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===a[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&a.splice(1,1,e[1]),a.join(" "))}},{key:"verifyKey",value:function(e){var t=this;if(e.preventDefault(),this.state.safeKey){if("password"===this.state.safeKey.type||"master-password"===this.state.safeKey.type){var a=new TextEncoder;Object(y.a)(this.state.safeKey.data,a.encode(this.state.safePassword)).then((function(e){t.setState({safeSecretError:!1},(function(){Object(f.a)(e.payload,t.state.safe.alg_type).then((function(a){t.state.cb(!0,a,t.state.keepUnlocked,t.state.unlockKeyName,e.payload)}))}))})).catch((function(){t.setState({safeSecretError:!0})}))}else if("jwk"===this.state.safeKey.type)try{var n=JSON.parse(this.state.safeKeyJwk);Object(f.a)(n,n.alg).then((function(e){Object(y.a)(t.state.safeKey.data,e).then((function(e){t.setState({safeSecretError:!1},(function(){Object(f.a)(e.payload,t.state.safe.alg_type).then((function(a){t.state.cb(!0,a,t.state.keepUnlocked,t.state.unlockKeyName,e.payload)}))}))})).catch((function(){t.setState({safeSecretError:!0})}))})).catch((function(){t.setState({safeSecretError:!0})}))}catch(e){this.setState({safeSecretError:!0})}}else this.setState({safeSecretError:!0})}},{key:"closeModal",value:function(e,t){this.state.cb&&this.state.cb(t)}},{key:"render",value:function(){var e,t,a,n=this,r=[],s="form-control";return this.state.safe&&this.state.safeContent&&this.state.safeContent[this.state.safe.name]&&this.state.safeContent[this.state.safe.name].keyList&&("password"===this.state.safeKey.type||"master-password"===this.state.safeKey.type?(this.state.safeSecretError&&(s+=" is-invalid",e=o.a.createElement("div",{className:"invalid-feedback"},i.a.t("safeKeyError"))),a=o.a.createElement("input",{type:"password",className:s,autoComplete:"off",placeholder:i.a.t("safePassword"),onChange:function(e){return n.changePassword(e)},value:this.state.safePassword})):"jwk"===this.state.safeKey.type&&(a=o.a.createElement(we,{isError:this.state.safeSecretError,errorMessage:i.a.t("safeKeyError"),ph:i.a.t("safeKeyJwkPh"),cb:this.editSafeKeyJwk})),this.state.safeContent[this.state.safe.name].keyList.forEach((function(e,t){("password"===e.type||"master-password"===e.type||"jwk"===e.type)&&r.push(o.a.createElement("li",{key:t},o.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(t){return n.setSafeKey(t,e)}},e.display_name||e.name)))}))),this.state.allowKeepUnlocked&&(t=o.a.createElement("div",null,o.a.createElement("div",{className:"form-check"},o.a.createElement("input",{className:"form-check-input",type:"checkbox",checked:this.state.keepUnlocked,id:"keepUnlocked",onChange:function(e){return n.toggleKeepUnlocked(e)}}),o.a.createElement("label",{className:"form-check-label",htmlFor:"keepUnlocked"},i.a.t("keepUnlocked"))),o.a.createElement("div",{className:"mb-3"},o.a.createElement("input",{type:"text",className:"form-control",placeholder:this.getBrowserInfo(),onChange:function(e){return n.changeUnlockKeyName(e)},disabled:!this.state.keepUnlocked,id:"safeUnlockKeyName",value:this.state.unlockKeyName}),o.a.createElement("div",{className:"form-text",htmlFor:"safeUnlockKeyName"},i.a.t("safeUnlockKeyName"))))),o.a.createElement("div",{className:"modal",tabIndex:"-1",id:"modalUnlockSafe"},o.a.createElement("div",{className:"modal-dialog"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"modal-header"},o.a.createElement("h5",{className:"modal-title"},i.a.t("safeUnlockTitle")),o.a.createElement("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:function(e){return n.closeModal(e,!1)}})),o.a.createElement("form",{onSubmit:this.verifyKey},o.a.createElement("div",{className:"modal-body"},o.a.createElement("div",{className:"input-group mb-3"},o.a.createElement("div",{className:"input-group-prepend"},o.a.createElement("label",{className:"input-group-text",htmlFor:"safeKeySelect"},i.a.t("safeKeySelect"))),o.a.createElement("button",{className:"btn btn-outline-secondary dropdown-toggle",type:"button",id:"safeKeySelect","data-bs-toggle":"dropdown","aria-expanded":"false"},this.state.safeKey.display_name||this.state.safeKey.name),o.a.createElement("ul",{className:"dropdown-menu"},r)),o.a.createElement("div",{className:"input-group mb-3"},a,e),t),o.a.createElement("div",{className:"modal-footer"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(e){return n.closeModal(e,!1)}},i.a.t("modalClose")),o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:function(e){return n.verifyKey(e)}},i.a.t("modalOk")))))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=Object.assign({},e);return t.safeKey||(a.safeKey=De(e.safeContent,e.safe)),a}}]),a}();function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Me(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fe(e){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Be=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Fe(e);if(t){var o=Fe(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Le(t)&&"function"!=typeof t?Ae(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,safe:e.safe,safeContent:e.safeContent,editMode:e.editMode,nameMandatory:!1,namePresent:!1,safeKey:e.safeKey,addKey:!1,curSafeKeyContainer:!1,nextStep:!1,removeSafeKeyMessage:!1},n.saveSafe=n.saveSafe.bind(Ae(n)),n.cancelEditSafe=n.cancelEditSafe.bind(Ae(n)),n.addSafeKey=n.addSafeKey.bind(Ae(n)),n.saveSafeKey=n.saveSafeKey.bind(Ae(n)),n.removeSafeKey=n.removeSafeKey.bind(Ae(n)),n.removeSafeKeyConfirm=n.removeSafeKeyConfirm.bind(Ae(n)),n.editSafeKey=n.editSafeKey.bind(Ae(n)),n.completeAddSafeKey=n.completeAddSafeKey.bind(Ae(n)),n.completeSetSafeKey=n.completeSetSafeKey.bind(Ae(n)),n.unlockSafeCallback=n.unlockSafeCallback.bind(Ae(n)),n.createKeyForSafe=n.createKeyForSafe.bind(Ae(n)),n}return function(e,t,a){t&&Me(e.prototype,t),a&&Me(e,a)}(a,[{key:"editDisplayName",value:function(e){var t=this.state.safe;t.display_name=e.target.value,this.setState({safe:t})}},{key:"editEncType",value:function(e){var t=this.state.safe;t.enc_type=e.target.value,this.setState({safe:t})}},{key:"editAlgType",value:function(e){var t=this.state.safe;t.alg_type=e.target.value,this.setState({safe:t})}},{key:"saveSafe",value:function(e){e.preventDefault();var t=this.state.safe;1===this.state.editMode?(w.request(this.state.config.safe_endpoint,"POST",t).then((function(){v.sendMessage("App",{action:"saveSafe",safe:t}),$.snack("info",i.a.t("messageSaveSafe"))})).fail((function(){$.snack("warning",i.a.t("messageErrorSaveSafe"))})),this.setState({nameMandatory:!1,namePresent:!1})):w.request(this.state.config.safe_endpoint+"/"+t.name,"PUT",t).then((function(){v.sendMessage("App",{action:"saveSafe",safe:t}),$.snack("info",i.a.t("messageSaveSafe"))})).fail((function(){$.snack("warning",i.a.t("messageErrorSaveSafe"))}))}},{key:"cancelEditSafe",value:function(){v.sendMessage("App",{action:"nav",target:1!==this.state.editMode&&this.state.safe.name})}},{key:"createKeyForSafe",value:function(){var e=this;return Object(p.a)(this.state.safe.alg_type,{extractable:!0}).then((function(t){return Object(h.a)(t).then((function(t){return Object(f.a)(t,e.state.safe.alg_type).then((function(e){return{key:e,extractableKey:t}}))}))}))}},{key:"saveSafeKey",value:function(e,t){var a=this;if(bootstrap.Modal.getOrCreateInstance(document.querySelector("#modalSafeKey")).hide(),e)if("password"===t.safeKey.type||"master-password"===t.safeKey.type){var n="PBES2-HS256+A128KW";"A192KW"===this.state.safe.alg_type||"A192GCMKW"===this.state.safe.alg_type||"PBES2-HS384+A192KW"===this.state.safe.alg_type?n="PBES2-HS384+A192KW":"A256KW"!==this.state.safe.alg_type&&"A256GCMKW"!==this.state.safe.alg_type&&"PBES2-HS512+A256KW"!==this.state.safe.alg_type||(n="PBES2-HS512+A256KW");var o=(new TextEncoder).encode(t.password);this.state.addKey?this.state.safeContent[this.state.safe.name].key?this.completeAddSafeKey(o,t.safeKey,n):this.createKeyForSafe().then((function(e){var r=a.state.safeContent;r[a.state.safe.name].extractableKey=e.extractableKey,r[a.state.safe.name].key=e.key,a.setState({safeContent:r},(function(){a.completeAddSafeKey(o,t.safeKey,n)}))})):this.completeSetSafeKey(o,t.safeKey,n)}else"jwk"===t.safeKey.type?this.state.addKey?this.state.safeContent[this.state.safe.name].key?Object(f.a)(t.jwk,t.jwk.alg).then((function(e){a.completeAddSafeKey(e,t.safeKey,t.jwk.alg)})):this.createKeyForSafe().then((function(e){var n=a.state.safeContent;n[a.state.safe.name].extractableKey=e.extractableKey,n[a.state.safe.name].key=e.key,a.setState({safeContent:n},(function(){Object(f.a)(t.jwk,t.jwk.alg).then((function(e){a.completeAddSafeKey(e,t.safeKey,t.jwk.alg)}))}))})):Object(f.a)(t.jwk,t.jwk.alg).then((function(e){a.completeSetSafeKey(e,t.safeKey,t.jwk.alg)})):"browser"===t.safeKey.type&&w.request(this.state.config.safe_endpoint+"/"+this.state.safe.name+"/key/"+t.safeKey.name,"PUT",t.safeKey).then((function(){v.sendMessage("App",{action:"setSafeKey",target:a.state.safe,newSafeKey:t.safeKey,removeStorage:!1}),a.setState({curSafeKeyContainer:!1}),$.snack("info",i.a.t("safeLockUpdated"))}))}},{key:"addSafeKey",value:function(e,t){e.preventDefault(),!this.state.safeContent[this.state.safe.name].extractableKey&&this.state.safeContent[this.state.safe.name].keyList.length?this.setState({nextStep:this.addSafeKey},(function(){new bootstrap.Modal(document.getElementById("modalUnlockSafe"),{keyboard:!1}).show()})):this.setState({addKey:!0,curSafeKeyContainer:{name:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),display_name:"",type:t,data:""}},(function(){new bootstrap.Modal(document.getElementById("modalSafeKey"),{keyboard:!1}).show()}))}},{key:"completeAddSafeKey",value:function(e,t,a){var n=this;this.state.safeContent[this.state.safe.name].extractableKey?new b.a(this.state.safeContent[this.state.safe.name].extractableKey).setProtectedHeader({alg:a,enc:this.state.safe.enc_type,sign_key:this.state.config.sign_thumb}).encrypt(e).then((function(e){t.data=e,w.request(n.state.config.safe_endpoint+"/"+n.state.safe.name+"/key","POST",t).then((function(){v.sendMessage("App",{action:"updateSafeKey",safe:n.state.safe}),$.snack("info",i.a.t("safeLockAdded"))}))})):$.snack("warning",i.a.t("lockedSafe"))}},{key:"editSafeKey",value:function(e,t){var a=this,n={addKey:!1};t&&(n.curSafeKeyContainer=t),this.setState(n,(function(){a.state.safeContent[a.state.safe.name].extractableKey?new bootstrap.Modal(document.getElementById("modalSafeKey"),{keyboard:!1}).show():a.setState({nextStep:a.editSafeKey},(function(){new bootstrap.Modal(document.getElementById("modalUnlockSafe"),{keyboard:!1}).show()}))}))}},{key:"completeSetSafeKey",value:function(e,t,a){var n=this;this.state.safeContent[this.state.safe.name].extractableKey?new b.a(this.state.safeContent[this.state.safe.name].extractableKey).setProtectedHeader({alg:a,enc:this.state.safe.enc_type,sign_key:this.state.config.sign_thumb}).encrypt(e).then((function(e){t.data=e,w.request(n.state.config.safe_endpoint+"/"+n.state.safe.name+"/key/"+t.name,"PUT",t).then((function(){v.sendMessage("App",{action:"setSafeKey",target:n.state.safe,newSafeKey:t,removeStorage:!1}),n.setState({curSafeKeyContainer:!1}),$.snack("info",i.a.t("safeLockUpdated"))}))})):$.snack("warning",i.a.t("lockedSafe"))}},{key:"removeSafeKey",value:function(e,t){var a=this;e&&e.preventDefault();var n={};t&&(n.curSafeKeyContainer=t,n.removeSafeKeyMessage=i.a.t("removeSafeKeyMessage",{name:t.display_name})),this.setState(n,(function(){a.state.safeContent[a.state.safe.name].extractableKey?new bootstrap.Modal(document.getElementById("removeSafeKey"),{keyboard:!1}).show():a.setState({nextStep:a.removeSafeKey},(function(){new bootstrap.Modal(document.getElementById("modalUnlockSafe"),{keyboard:!1}).show()}))}))}},{key:"removeSafeKeyConfirm",value:function(e){var t=this;e&&w.request(this.state.config.safe_endpoint+"/"+this.state.safe.name+"/key/"+this.state.curSafeKeyContainer.name,"DELETE").then((function(){t.setState({curSafeKeyContainer:!1},(function(){$.snack("info",i.a.t("messageRemoveSafeKey")),v.sendMessage("App",{action:"updateSafeKey",safe:t.state.safe})}))})).fail((function(){$.snack("warning",i.a.t("messageErrorSaveSafeKey"))})),bootstrap.Modal.getOrCreateInstance(document.querySelector("#removeSafeKey")).hide()}},{key:"unlockSafeCallback",value:function(e,t,a,n,o){bootstrap.Modal.getOrCreateInstance(document.querySelector("#modalUnlockSafe")).hide(),e&&(v.sendMessage("App",{action:"unlockSafe",safe:this.state.safe,extractableKey:o}),this.state.nextStep&&this.state.nextStep())}},{key:"render",value:function(){var e,t=this,a=[];if(this.state.safeContent&&this.state.safe&&this.state.safeContent[this.state.safe.name]){var n=0;this.state.safeContent[this.state.safe.name].keyList.forEach((function(e){-1!==["password","master-password"].indexOf(e.type)&&n++})),this.state.safeContent[this.state.safe.name].keyList.forEach((function(e,r){var s="fa btn-icon ";"password"===e.type?s+="fa-key":"master-password"===e.type?s+="fa-unlock":"jwk"===e.type?s+="fa-file-code-o":"browser"===e.type&&(s+="fa-firefox"),a.push(o.a.createElement("div",{className:"input-group",key:r},o.a.createElement("div",{className:"input-group-text"},o.a.createElement("i",{className:s,"aria-hidden":"true"}),e.display_name||e.name),o.a.createElement("div",{className:"btn-group me-2",role:"group"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return t.editSafeKey(a,e)}},o.a.createElement("i",{className:"fa fa-pencil","aria-hidden":"true"})),o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(a){return t.removeSafeKey(a,e)},disabled:n<=1&&-1!==["password","master-password"].indexOf(e.type)},o.a.createElement("i",{className:"fa fa-trash","aria-hidden":"true"})))))}))}return this.state.curSafeKeyContainer&&(e=o.a.createElement(Pe,{safeKey:this.state.curSafeKeyContainer,callback:this.saveSafeKey})),o.a.createElement("div",null,o.a.createElement("form",{onSubmit:this.saveSafe},o.a.createElement("input",{type:"hidden",id:"safeName",value:this.state.safe.name}),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"safeDisplayName",className:"form-label"},i.a.t("safeDisplayName")),o.a.createElement("input",{type:"text",className:"form-control",id:"safeDisplayName",value:this.state.safe.display_name||"",onChange:function(e){return t.editDisplayName(e)}})),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"encType",className:"form-label"},i.a.t("safeEncType")),o.a.createElement("select",{disabled:2===this.state.editMode,className:"form-select","aria-label":"enc type",id:"encType",onChange:function(e){return t.editEncType(e)},value:this.state.safe.enc_type},o.a.createElement("option",{value:"A128CBC-HS256"},"A128CBC-HS256"),o.a.createElement("option",{value:"A192CBC-HS384"},"A192CBC-HS384"),o.a.createElement("option",{value:"A256CBC-HS512"},"A256CBC-HS512"),o.a.createElement("option",{value:"A128GCM"},"A128GCM"),o.a.createElement("option",{value:"A192GCM"},"A192GCM"),o.a.createElement("option",{value:"A256GCM"},"A256GCM"))),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"algType",className:"form-label"},i.a.t("safeAlgType")),o.a.createElement("select",{disabled:2===this.state.editMode,className:"form-select","aria-label":"enc type",id:"algType",onChange:function(e){return t.editAlgType(e)},value:this.state.safe.alg_type},o.a.createElement("option",{value:"A128KW"},"A128KW"),o.a.createElement("option",{value:"A192KW"},"A192KW"),o.a.createElement("option",{value:"A256KW"},"A256KW"),o.a.createElement("option",{value:"A128GCMKW"},"A128GCMKW"),o.a.createElement("option",{value:"A192GCMKW"},"A192GCMKW"),o.a.createElement("option",{value:"A256GCMKW"},"A256GCMKW"),o.a.createElement("option",{value:"PBES2-HS256+A128KW"},"PBES2-HS256+A128KW"),o.a.createElement("option",{value:"PBES2-HS384+A192KW"},"PBES2-HS384+A192KW"),o.a.createElement("option",{value:"PBES2-HS512+A256KW"},"PBES2-HS512+A256KW"))),o.a.createElement("div",{className:"alert alert-primary",role:"alert"},o.a.createElement("div",{className:"btn-toolbar justify-content-between",role:"toolbar"},i.a.t("safeKeyList"),o.a.createElement("div",{className:"input-group"},o.a.createElement("div",{className:"input-group mb-3"},o.a.createElement("button",{className:"btn btn-outline-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},o.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"})),o.a.createElement("ul",{className:"dropdown-menu"},o.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){return t.addSafeKey(e,"password")}},i.a.t("securityTypePassword")),o.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){return t.addSafeKey(e,"master-password")}},i.a.t("securityTypeMasterPassword")),o.a.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){return t.addSafeKey(e,"jwk")}},i.a.t("securityTypeJwk"))))))),o.a.createElement("div",{className:"btn-toolbar mb-3",role:"toolbar"},a),o.a.createElement("div",{className:"btn-toolbar justify-content-between",role:"toolbar"},o.a.createElement("div",{className:"btn-group",role:"group","aria-label":"First group"},o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:this.saveSafe},i.a.t("profileSubmit")),o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.cancelEditSafe},i.a.t("profileCancel"))))),o.a.createElement(Z,{name:"removeSafeKey",title:i.a.t("removeSafeKeyTitle"),message:this.state.removeSafeKeyMessage,cb:this.removeSafeKeyConfirm}),e,o.a.createElement(Ke,{config:this.state.config,safe:this.state.safe,safeContent:this.state.safeContent,allowKeepUnlocked:!1,cb:this.unlockSafeCallback}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function Ue(e){return(Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function We(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ve(e){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ge=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Ve(e);if(t){var o=Ve(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Ue(t)&&"function"!=typeof t?$e(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={cb:e.cb,name:e.name,content:e.content,iconListOrig:{},iconList:{},iconFilter:"",displayNameError:!1},n.changeDisplayName=n.changeDisplayName.bind($e(n)),n.useIcon=n.useIcon.bind($e(n)),w.request("fonts/forkawesome-ful-list.json").then((function(e){n.setState({iconListOrig:e,iconList:e})})),n}return function(e,t,a){t&&We(e.prototype,t),a&&We(e,a)}(a,[{key:"changeDisplayName",value:function(e){var t=this.state.content;t.displayName=e.target.value,this.setState({content:t,displayNameError:!1})}},{key:"changeIconFilter",value:function(e){var t=this;this.setState({iconFilter:e.target.value},(function(){if(t.state.iconFilter){var e={};Object.keys(t.state.iconListOrig).forEach((function(a){e[a]=[],t.state.iconListOrig[a].forEach((function(n){n.label.toUpperCase().search(t.state.iconFilter.toUpperCase())>-1&&e[a].push(n)})),e[a].length||delete e[a]})),t.setState({iconList:e})}else t.setState({iconList:t.state.iconListOrig})}))}},{key:"useIcon",value:function(e,t){e.preventDefault();var a=this.state.content;a.icon=t.icon,this.setState({content:a})}},{key:"verifyDisplayName",value:function(e){e.preventDefault(),this.state.content.displayName?this.closeModal(e,!0):this.setState({displayNameError:!0})}},{key:"closeModal",value:function(e,t){this.state.cb&&this.state.cb(t,this.state.name,this.state.content,!0)}},{key:"render",value:function(){var e,t,a=this,n=[],r="form-control";return Object.keys(this.state.iconList).forEach((function(e){var t=a.state.iconList[e];n.push(o.a.createElement("li",{className:"list-group-item",key:e},o.a.createElement("span",{className:"badge bg-secondary"},e)));var r=[];t.forEach((function(t,n){r.push(o.a.createElement("a",{key:e+"-"+n,href:"",onClick:function(e){return a.useIcon(e,t)},className:"btn btn-primary btn-icon btn-icon-top"},o.a.createElement("span",{className:"btn-icon"},t.label),o.a.createElement("i",{className:t.icon,"aria-hidden":"true"})))})),n.push(o.a.createElement("li",{className:"list-group-item",key:e+"-lst"},r))})),this.state.content.icon&&(e=o.a.createElement("i",{className:"btn-icon-right "+this.state.content.icon,"aria-hidden":"true"})),this.state.displayNameError&&(r+=" is-invalid",t=o.a.createElement("div",{className:"invalid-feedback"},i.a.t("displayNameError"))),o.a.createElement("div",{className:"modal",tabIndex:"-1",id:"modalCoinEdit"},o.a.createElement("div",{className:"modal-dialog"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"modal-header"},o.a.createElement("h5",{className:"modal-title"},this.state.name?i.a.t("CoinEditTitle"):i.a.t("CoinAddTitle")),o.a.createElement("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:function(e){return a.closeModal(e,!1)}})),o.a.createElement("form",{onSubmit:function(e){return a.verifyDisplayName(e)}},o.a.createElement("div",{className:"modal-body"},o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"coinDisplayName",className:"form-label"},i.a.t("coinDisplayName")),o.a.createElement("input",{type:"text",maxLength:"128",className:r,id:"coinDisplayName",value:this.state.content.displayName||"",onChange:function(e){return a.changeDisplayName(e)}}),t),o.a.createElement("hr",null),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{className:"form-label"},i.a.t("coinIconList"),e),o.a.createElement("input",{type:"text",maxLength:"128",className:"form-control",id:"coinIconFilter",placeholder:i.a.t("coinIconFilterPh"),value:this.state.iconFilter||"",onChange:function(e){return a.changeIconFilter(e)}}),o.a.createElement("ul",{className:"list-group icon-list"},n))),o.a.createElement("div",{className:"modal-footer"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(e){return a.closeModal(e,!1)}},i.a.t("modalClose")),o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:function(e){return a.verifyDisplayName(e)}},i.a.t("modalOk")))))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}(),qe=a(51);function He(e){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qe(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ze(e,t){return(ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ye(e){return(Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ze=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ze(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Ye(e);if(t){var o=Ye(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==He(t)&&"function"!=typeof t?Xe(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,safe:e.safe,content:e.content,id:e.id,name:e.name,exportSafeWithSecurity:!1,exportSecurityType:"password",pwdScore:-1,password:"",confirmPassword:"",exportInvalid:!1,exportJwk:""},n.toggleExportSafeWithSecurity=n.toggleExportSafeWithSecurity.bind(Xe(n)),n.changeExportSecurityType=n.changeExportSecurityType.bind(Xe(n)),n.changePassword=n.changePassword.bind(Xe(n)),n.changeConfirmPassword=n.changeConfirmPassword.bind(Xe(n)),n.exportSafe=n.exportSafe.bind(Xe(n)),n.editExportJwk=n.editExportJwk.bind(Xe(n)),n}return function(e,t,a){t&&Qe(e.prototype,t)}(a,[{key:"toggleExportSafeWithSecurity",value:function(){var e=this;this.setState({exportSafeWithSecurity:!this.state.exportSafeWithSecurity,importData:!1,importDataResult:!1,importTotalCount:0,importTotalSuccess:0,importSecurityType:!1},(function(){e.setState({exportInvalid:e.isExportInvalid()})}))}},{key:"changeExportSecurityType",value:function(e){var t=this;this.setState({exportSecurityType:e.target.value},(function(){t.setState({exportInvalid:t.isExportInvalid()})}))}},{key:"changePassword",value:function(e){var t=this,a=-1;e.target.value&&(a=zxcvbn(e.target.value).score),this.setState({password:e.target.value,pwdScore:a},(function(){t.setState({exportInvalid:t.isExportInvalid()})}))}},{key:"changeConfirmPassword",value:function(e){var t=this;this.setState({confirmPassword:e.target.value},(function(){t.setState({exportInvalid:t.isExportInvalid()})}))}},{key:"editExportJwk",value:function(e){var t=this;this.setState({exportJwk:e},(function(){t.setState({exportInvalid:t.isExportInvalid()})}))}},{key:"isExportInvalid",value:function(){if(this.state.exportSafeWithSecurity)if("password"===this.state.exportSecurityType){if(!this.state.password||this.state.password!==this.state.confirmPassword)return!0}else if("jwk"===this.state.exportSecurityType)try{if(!this.state.exportJwk||!JSON.parse(this.state.exportJwk).alg)return!0}catch(e){return!0}return!1}},{key:"exportSafe",value:function(){var e=this,t=[];if(this.state.content.forEach((function(e){t.push(e.data)})),this.state.exportSafeWithSecurity){if("password"===this.state.exportSecurityType){var a=(new TextEncoder).encode(this.state.password),n="PBES2-HS256+A128KW";"A192KW"===this.state.safe.alg_type||"A192GCMKW"===this.state.safe.alg_type||"PBES2-HS384+A192KW"===this.state.safe.alg_type?n="PBES2-HS384+A192KW":"A256KW"!==this.state.safe.alg_type&&"A256GCMKW"!==this.state.safe.alg_type&&"PBES2-HS512+A256KW"!==this.state.safe.alg_type||(n="PBES2-HS512+A256KW"),new b.a({data:t}).setProtectedHeader({alg:n,enc:this.state.safe.enc_type,sign_key:this.state.config.sign_thumb}).encrypt(a).then((function(t){var a=$("#"+e.state.id+"-download");a.attr("href","data:application/octet-stream;base64,"+btoa(t)),a.attr("download",e.state.name+".jwt"),a[0].click()}))}else if("jwk"===this.state.exportSecurityType){var o=JSON.parse(this.state.exportJwk);o.use="enc",Object(f.a)(o,o.alg).then((function(a){"public"===a.type||"secret"===a.type?new b.a({data:t}).setProtectedHeader({alg:o.alg,enc:e.state.safe.enc_type,sign_key:e.state.config.sign_thumb}).encrypt(a).then((function(t){var a=$("#"+e.state.id+"-download");a.attr("href","data:application/octet-stream;base64,"+btoa(t)),a.attr("download",e.state.name+".jwt"),a[0].click()})):e.setState({exportInvalid:1})}))}}else{var r=$("#"+this.state.id+"-download");r.attr("href","data:application/octet-stream;base64,"+btoa(JSON.stringify(t))),r.attr("download",this.state.name+".json"),r[0].click()}}},{key:"render",value:function(){var e,t,a;if(this.state.exportSafeWithSecurity)if(e=o.a.createElement("select",{className:"form-select",value:this.state.exportSecurityType,onChange:this.changeExportSecurityType},o.a.createElement("option",{value:"password"},i.a.t("securityTypePassword")),o.a.createElement("option",{value:"jwk"},i.a.t("securityTypeJwk"))),"password"===this.state.exportSecurityType)0===this.state.pwdScore?a=o.a.createElement("span",{className:"badge bg-danger"},i.a.t("pwdScoreTooGuessable")):1===this.state.pwdScore?a=o.a.createElement("span",{className:"badge bg-warning"},i.a.t("pwdScoreVeryGuessable")):2===this.state.pwdScore?a=o.a.createElement("span",{className:"badge bg-secondary"},i.a.t("pwdScoreSomewhatGuessable")):3===this.state.pwdScore?a=o.a.createElement("span",{className:"badge bg-primary"},i.a.t("pwdScoreSafelyUnguessable")):4===this.state.pwdScore&&(a=o.a.createElement("span",{className:"badge bg-success"},i.a.t("pwdScoreVeryUnguessable"))),t=o.a.createElement("div",null,o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"newPassword",className:"form-label"},i.a.t("newPassword")),o.a.createElement("input",{type:"password",autoComplete:"off",className:"form-control",id:"newPassword",value:this.state.password,onChange:this.changePassword}),a),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"confirmNewPassword",className:"form-label"},i.a.t("confirmNewPassword")),o.a.createElement("input",{type:"password",autoComplete:"off",className:"form-control",id:"confirmNewPassword",value:this.state.confirmPassword,onChange:this.changeConfirmPassword})));else if("jwk"===this.state.exportSecurityType){var n;this.state.exportInvalid&&(n=o.a.createElement("div",{className:"invalid-feedback"},i.a.t("jwkError"))),t=o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"exportJwk",className:"form-label"},i.a.t("exportJwk")),o.a.createElement(we,{isError:this.state.exportInvalid,errorMessage:i.a.t("safeSecretError"),ph:i.a.t("safeKeyJwkPh"),cb:this.editExportJwk}),n)}return o.a.createElement("div",null,o.a.createElement("div",{className:"mb-3"},o.a.createElement("div",{className:"form-check"},o.a.createElement("input",{className:"form-check-input",type:"checkbox",value:"",id:"exportSafeWithSecurity",checked:this.state.exportSafeWithSecurity,onChange:this.toggleExportSafeWithSecurity}),o.a.createElement("label",{className:"form-check-label",htmlFor:"exportSafeWithSecurity"},i.a.t("exportSafeWithSecurity")))),e,o.a.createElement("form",null,t),o.a.createElement("div",{className:"mb-3"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.exportSafe,title:i.a.t("downloadExport"),disabled:this.state.exportInvalid},o.a.createElement("i",{className:"fa fa-cloud-download","aria-hidden":"true"}))),o.a.createElement("a",{className:"upload",id:this.state.id+"-download"}))}}]),a}();function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function at(e,t){return(at=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function nt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ot(e){return(ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var rt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&at(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=ot(e);if(t){var o=ot(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==et(t)&&"function"!=typeof t?nt(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,safe:e.safe,safeContent:e.safeContent,cbSaveCoin:e.cbSaveCoin,cbClose:e.cbClose,exportSafeWithSecurity:!1,exportSecurityType:"password",password:"",confirmPassword:"",pwdScore:-1,importJwk:"",errorExportJwk:!1,exportInvalid:!1,importData:!1,importDataResult:!1,importTotalCount:0,importTotalSuccess:0,importSecurityType:!1,importRunning:!1},n.changePassword=n.changePassword.bind(nt(n)),n.getImportFile=n.getImportFile.bind(nt(n)),n.parseContent=n.parseContent.bind(nt(n)),n.importContent=n.importContent.bind(nt(n)),n.completeImportContent=n.completeImportContent.bind(nt(n)),n.editImportJwk=n.editImportJwk.bind(nt(n)),n}return function(e,t,a){t&&tt(e.prototype,t),a&&tt(e,a)}(a,[{key:"changePassword",value:function(e){var t=this,a=-1;e.target.value&&(a=zxcvbn(e.target.value).score),this.setState({password:e.target.value,pwdScore:a},(function(){t.setState({exportInvalid:t.isImportInvalid()})}))}},{key:"isImportInvalid",value:function(){if(this.state.exportSafeWithSecurity)if("password"===this.state.exportSecurityType){if(!this.state.password||this.state.password!==this.state.confirmPassword)return!0}else if("jwk"===this.state.exportSecurityType)try{if(!this.state.importJwk||!JSON.parse(this.state.importJwk).alg)return!0}catch(e){return!0}return!1}},{key:"editImportJwk",value:function(e){var t=this;this.setState({importJwk:e},(function(){t.setState({exportInvalid:t.isImportInvalid()})}))}},{key:"getImportFile",value:function(e){var t=this;this.setState({exportSafeWithSecurity:!1,importData:!1,importDataResult:!1,importTotalCount:0,importTotalSuccess:0,importSecurityType:!1},(function(){var a=e.target.files[0],n=new FileReader;n.onload=function(e){t.setState({importData:e.target.result},(function(){t.parseContent()}))},n.readAsText(a)}))}},{key:"parseContent",value:function(){if(this.state.importData){var e=!1;try{e=JSON.parse(this.state.importData)}catch(e){}if(e&&Array.isArray(e))this.importContent(e);else{var t=!1;try{t=Object(qe.a)(this.state.importData)}catch(e){this.setState({importDataResult:"invalidData"})}t&&("PBES2-HS256+A128KW"===t.alg||"PBES2-HS384+A192KW"===t.alg||"PBES2-HS512+A256KW"===t.alg?this.setState({importSecurityType:"password"}):this.setState({importSecurityType:"jwk"}))}}else this.setState({importDataResult:"invalidData"})}},{key:"completeImportContent",value:function(){var e=this;if("password"===this.state.importSecurityType){var t=new TextEncoder;Object(y.a)(this.state.importData,t.encode(this.state.password)).then((function(t){e.importContent(t.payload.data)})).catch((function(){e.setState({importDataResult:"invalidPassword"})}))}else if("jwk"===this.state.importSecurityType)try{var a=JSON.parse(this.state.importJwk);a.use="enc",Object(f.a)(a,a.alg).then((function(t){Object(y.a)(e.state.importData,t).then((function(t){e.importContent(t.payload.data)})).catch((function(){e.setState({importDataResult:"invalidJwk"})}))}))}catch(e){this.setState({importDataResult:"invalidJwk"})}}},{key:"importContent",value:function(e){var t=this,a=0,n=0;this.setState({importRunning:!0},(function(){e.forEach((function(o){try{t.state.cbSaveCoin(!0,!1,o).then((function(){a++})).catch((function(){$.snack("warning",i.a.t("messageErrorCoinSave"))})).finally((function(){++n===e.length&&(n===a?t.setState({importDataResult:"importComplete",importTotalCount:a,importRunning:!1}):t.setState({importDataResult:"importIncomplete",importTotalCount:a,importTotalSuccess:n,importRunning:!1}))}))}catch(o){++n===e.length&&(n===a?t.setState({importDataResult:"importComplete",importTotalCount:a,importRunning:!1}):t.setState({importDataResult:"importIncomplete",importTotalCount:a,importTotalSuccess:n,importRunning:!1}))}}))}))}},{key:"closeModal",value:function(e,t){this.state.cbClose&&this.state.cbClose()}},{key:"render",value:function(){var e,t,a,n=this;if("invalidData"===this.state.importDataResult?e=o.a.createElement("div",{className:"alert alert-danger",role:"alert"},i.a.t("importInvalidData")):"importComplete"===this.state.importDataResult?e=o.a.createElement("div",{className:"alert alert-success",role:"alert"},i.a.t("importComplete",{count:this.state.importTotalCount})):"importIncomplete"===this.state.importDataResult?e=o.a.createElement("div",{className:"alert alert-warning",role:"alert"},i.a.t("importIncomplete",{count:this.state.importTotalCount,total:this.state.importTotalSuccess})):"invalidPassword"===this.state.importDataResult?e=o.a.createElement("div",{className:"alert alert-danger",role:"alert"},i.a.t("importInvalidPassword")):"invalidJwk"===this.state.importDataResult&&(e=o.a.createElement("div",{className:"alert alert-danger",role:"alert"},i.a.t("importInvalidKey"))),this.state.importSecurityType){var r;this.state.importRunning&&(r=o.a.createElement("i",{className:"fa fa-spinner fa-spin fa-fw btn-icon-right"}));var s="password"===this.state.importSecurityType&&!this.state.password||"jwk"===this.state.importSecurityType&&!this.state.importJwk;a=o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.completeImportContent,title:i.a.t("modalOk"),disabled:s||this.state.importRunning},i.a.t("modalOk"),r)}return"password"===this.state.importSecurityType?t=o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"newPassword",className:"form-label"},i.a.t("importPassword")),o.a.createElement("input",{type:"password",className:"form-control",id:"password",value:this.state.password,onChange:this.changePassword})):"jwk"===this.state.importSecurityType&&(t=o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"importJwk",className:"form-label"},i.a.t("importJwk")),o.a.createElement(we,{isError:!1,ph:i.a.t("safeKeyJwkPh"),cb:this.editImportJwk}))),o.a.createElement("div",{className:"modal",tabIndex:"-1",id:"manageSafe"},o.a.createElement("div",{className:"modal-dialog"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"modal-header"},o.a.createElement("h5",{className:"modal-title"},i.a.t("manageSafe")),o.a.createElement("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:function(e){return n.closeModal(e,!1)}})),o.a.createElement("div",{className:"modal-body"},o.a.createElement("div",{className:"mb-3"},o.a.createElement("div",{className:"alert alert-primary",role:"alert"},i.a.t("exportSafe"))),o.a.createElement(Ze,{config:this.state.config,safe:this.state.safe,content:this.state.safeContent[this.state.safe.name].unlockedCoinList,id:this.state.safe.name,name:this.state.safe.display_name}),o.a.createElement("hr",null),o.a.createElement("div",{className:"mb-3"},o.a.createElement("div",{className:"alert alert-primary",role:"alert"},i.a.t("importSafe"))),o.a.createElement("div",{className:"mb-3"},o.a.createElement("input",{type:"file",className:"upload",id:"importSafeFileInput",onChange:this.getImportFile}),o.a.createElement("label",{htmlFor:"importSafeFileInput",className:"btn btn-secondary"},o.a.createElement("i",{className:"fa fa-cloud-upload","aria-hidden":"true"})),t,a,e),o.a.createElement("div",{className:"modal-footer"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(e){return n.closeModal(e,!1)}},i.a.t("modalClose")))))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function st(e){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function it(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ct(e,t){return(ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e){return(ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ft=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ct(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=ut(e);if(t){var o=ut(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==st(t)&&"function"!=typeof t?lt(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={coin:e.coin,element:e.element,index:e.index,cbSave:e.cbSave,cbCancel:e.cbCancel,isDraggable:e.isDraggable,cbOnDragStart:e.cbOnDragStart,cbOnDragOver:e.cbOnDragOver},n.changeValue=n.changeValue.bind(lt(n)),n}return function(e,t,a){t&&it(e.prototype,t),a&&it(e,a)}(a,[{key:"changeValue",value:function(e){var t=this.state.element;t.value=e.target.value,this.setState({element:t})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{draggable:this.state.isDraggable,onDragStart:this.state.cbOnDragStart,onDragOver:this.state.cbOnDragOver,id:this.state.coin.name+"-"+this.state.index},o.a.createElement("form",{onSubmit:function(t){return e.state.cbSave(t,e.state.element,e.state.index)}},o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:this.state.coin.name+"-"+this.state.index,className:"form-label"},i.a.t("coinElementUrl")),o.a.createElement("input",{type:"text",className:"form-control",id:this.state.coin.name+"-"+this.state.index,value:this.state.element.value,placeholder:i.a.t("coinElementUrlPh"),onChange:this.changeValue})),o.a.createElement("div",{className:"mb-3 btn-group"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.state.cbCancel(t,e.state.index)}},i.a.t("modalClose")),o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:function(t){return e.state.cbSave(t,e.state.element,e.state.index)},disabled:!this.state.element.value},i.a.t("modalOk")))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function mt(e){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function pt(e,t){return(pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ht(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bt(e){return(bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var yt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pt(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=bt(e);if(t){var o=bt(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==mt(t)&&"function"!=typeof t?ht(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={coin:e.coin,element:e.element,index:e.index,cbSave:e.cbSave,cbCancel:e.cbCancel,isDraggable:e.isDraggable,cbOnDragStart:e.cbOnDragStart,cbOnDragOver:e.cbOnDragOver},n.changeValue=n.changeValue.bind(ht(n)),n}return function(e,t,a){t&&dt(e.prototype,t),a&&dt(e,a)}(a,[{key:"changeValue",value:function(e){var t=this.state.element;t.value=e.target.value,this.setState({element:t})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{draggable:this.state.isDraggable,onDragStart:this.state.cbOnDragStart,onDragOver:this.state.cbOnDragOver,id:this.state.coin.name+"-"+this.state.index},o.a.createElement("form",{onSubmit:function(t){return e.state.cbSave(t,e.state.element,e.state.index)}},o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:this.state.coin.name+"-"+this.state.index,className:"form-label"},i.a.t("coinElementLogin")),o.a.createElement("input",{type:"text",className:"form-control",id:this.state.coin.name+"-"+this.state.index,value:this.state.element.value,placeholder:i.a.t("coinElementLoginPh"),onChange:this.changeValue})),o.a.createElement("div",{className:"mb-3 btn-group"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.state.cbCancel(t,e.state.index)}},i.a.t("modalClose")),o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:function(t){return e.state.cbSave(t,e.state.element,e.state.index)},disabled:!this.state.element.value},i.a.t("modalOk")))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function gt(e){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Et(e,t){return(Et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function wt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function St(e){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var kt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Et(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=St(e);if(t){var o=St(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==gt(t)&&"function"!=typeof t?wt(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,cb:e.callback,element:e.element,originalPassword:e.originalPassword,wordsLists:{},showPassword:!1,passwordGenerated:!1},n.toggleShowPassword=n.toggleShowPassword.bind(wt(n)),n.toggleParam=n.toggleParam.bind(wt(n)),n.changePasswordLength=n.changePasswordLength.bind(wt(n)),n.generateRandomChars=n.generateRandomChars.bind(wt(n)),n.changePasswordWordsNumber=n.changePasswordWordsNumber.bind(wt(n)),n.changePasswordWordsSeparator=n.changePasswordWordsSeparator.bind(wt(n)),n.generateRandomWords=n.generateRandomWords.bind(wt(n)),n.copyOriginalPassword=n.copyOriginalPassword.bind(wt(n)),n.copyNewPassword=n.copyNewPassword.bind(wt(n)),n.state.config.frontend.lang.forEach((function(e){w.request("words-"+e+".json").then((function(t){var a=n.state.wordsLists;a[e]=t,n.setState({wordsLists:a})}))})),n}return function(e,t,a){t&&vt(e.prototype,t),a&&vt(e,a)}(a,[{key:"toggleShowPassword",value:function(){this.setState({showPassword:!this.state.showPassword})}},{key:"toggleParam",value:function(e,t){var a=this.state.element;a.params[t]=!a.params[t],this.setState({element:a})}},{key:"changePasswordLength",value:function(e){var t=this.state.element;e.target.value?t.params.passwordCharLength=parseInt(e.target.value):t.params.passwordCharLength=0,this.setState({element:t})}},{key:"closeModal",value:function(e,t){this.state.cb&&this.state.cb(t,this.state.element)}},{key:"randomCharsRangeList",value:function(e,t){var a=new Uint8Array(e);window.crypto.getRandomValues(a);for(var n=0;n<e;n++)for(;a[n]>=t;){var o=new Uint8Array(1);window.crypto.getRandomValues(o),a[n]=o[0]}return a}},{key:"randomWordsRangeList",value:function(e,t){var a=new Uint32Array(e);window.crypto.getRandomValues(a);for(var n=0;n<e;n++)for(;a[n]>=t;){var o=new Uint32Array(1);window.crypto.getRandomValues(o),a[n]=o[0]}return a}},{key:"generateRandomChars",value:function(){var e="";this.state.element.params.lowercase&&(e+="abcdefghijklmnopqrstuvwxyz"),this.state.element.params.upprcase&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),this.state.element.params.numbers&&(e+="0123456789"),this.state.element.params.special&&(e+="!\"#$%&\\'()*+,-./:;<=>?@[]^_`{|}~"),this.state.element.params.spaces&&(e+=" ");var t=this.randomCharsRangeList(this.state.element.params.passwordCharLength,e.length);if(this.state.element.params.noSimilarFollowingChars)for(var a=1;a<this.state.element.params.passwordCharLength;a++)for(;t[a]===t[a-1];){var n=this.randomCharsRangeList(1,e.length);t[a]=n[0]}var o="";for(a=0;a<this.state.element.params.passwordCharLength;a++)o+=e[t[a]];var r=this.state.element;r.params.type="chars",r.value=o,this.setState({element:r,passwordGenerated:!0})}},{key:"changePasswordWordsNumber",value:function(e){var t=this.state.element;e.target.value?t.params.wordsNumber=parseInt(e.target.value):t.params.wordsNumber=0,this.setState({element:t})}},{key:"toggleWordsLang",value:function(e,t){var a=this.state.element;-1!==a.params.wordsLangsList.indexOf(t)?a.params.wordsLangsList.splice(a.params.wordsLangsList.indexOf(t),1):a.params.wordsLangsList.push(t),this.setState({element:a})}},{key:"changePasswordWordsSeparator",value:function(e){var t=this.state.element;t.params.wordSeparator=e.target.value,this.setState({element:t})}},{key:"generateRandomWords",value:function(){var e=this,t=[];this.state.element.params.wordsLangsList.forEach((function(a){t=t.concat(e.state.wordsLists[a])}));for(var a=this.randomWordsRangeList(this.state.element.params.wordsNumber,t.length),n=[],o=0;o<this.state.element.params.wordsNumber;o++)n.push(t[a[o]]);var r=this.state.element;r.params.type="words",r.value=n.join(this.state.element.params.wordSeparator),this.setState({element:r,passwordGenerated:!0})}},{key:"copyOriginalPassword",value:function(){navigator.clipboard.writeText(this.state.originalPassword).then((function(){$.snack("info",i.a.t("messageCopyOriginalPasswordToClipboard"))}))}},{key:"copyNewPassword",value:function(){navigator.clipboard.writeText(this.state.element.value).then((function(){$.snack("info",i.a.t("messageCopyNewPasswordToClipboard"))}))}},{key:"render",value:function(){var e=this,t="chars"===this.state.element.params.type,a="chars"!==this.state.element.params.type;"chars"===this.state.element.params.type?t=" show":a=" show";var n=o.a.createElement("div",{className:"alert alert-primary",role:"alert"},i.a.t("newPassword"));this.state.showPassword&&this.state.passwordGenerated?n=o.a.createElement("div",{className:"alert alert-secondary",role:"alert"},o.a.createElement("code",null,this.state.element.value)):this.state.passwordGenerated&&(n=o.a.createElement("div",{className:"alert alert-success",role:"alert"},i.a.t("messagePasswordGenerated")));var r=[];return this.state.config.frontend.lang.forEach((function(t){r.push(o.a.createElement("div",{className:"form-group form-check",key:t},o.a.createElement("input",{type:"checkbox",className:"form-check-input",id:"passwordWordsLangs-"+t,onChange:function(a){return e.toggleWordsLang(a,t)},checked:-1!==e.state.element.params.wordsLangsList.indexOf(t)}),o.a.createElement("label",{className:"form-check-label",htmlFor:"passwordWordsLangs-"+t},i.a.t("passwordWordsLangs-"+t))))})),o.a.createElement("div",{className:"modal",tabIndex:"-1",id:"modalGeneratePassword"},o.a.createElement("div",{className:"modal-dialog"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"modal-header"},o.a.createElement("h5",{className:"modal-title"},i.a.t("modalGeneratePassword")),o.a.createElement("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:function(t){return e.closeModal(t,!1)}})),o.a.createElement("div",{className:"modal-body"},o.a.createElement("div",{className:"accordion",id:"passwordRandom"},o.a.createElement("div",{className:"accordion-item"},o.a.createElement("h2",{className:"accordion-header",id:"headingOne"},o.a.createElement("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#passwordRandomCharacters","aria-expanded":t?"true":"false","aria-controls":"passwordRandomCharacters"},i.a.t("passwordRandomCharacters"))),o.a.createElement("div",{id:"passwordRandomCharacters",className:"accordion-collapse collapse"+(t?" show":""),"aria-labelledby":"headingOne","data-bs-parent":"#passwordRandom"},o.a.createElement("div",{className:"accordion-body"},o.a.createElement("div",{className:"form-group form-check"},o.a.createElement("input",{type:"checkbox",className:"form-check-input",id:"lowercase",onChange:function(t){return e.toggleParam(t,"lowercase")},checked:this.state.element.params.lowercase}),o.a.createElement("label",{className:"form-check-label",htmlFor:"lowercase"},i.a.t("passwordRandomLowercase"))),o.a.createElement("div",{className:"form-group form-check"},o.a.createElement("input",{type:"checkbox",className:"form-check-input",id:"upprcase",onChange:function(t){return e.toggleParam(t,"upprcase")},checked:this.state.element.params.upprcase}),o.a.createElement("label",{className:"form-check-label",htmlFor:"upprcase"},i.a.t("passwordRandomUppercase"))),o.a.createElement("div",{className:"form-group form-check"},o.a.createElement("input",{type:"checkbox",className:"form-check-input",id:"numbers",onChange:function(t){return e.toggleParam(t,"numbers")},checked:this.state.element.params.numbers}),o.a.createElement("label",{className:"form-check-label",htmlFor:"numbers"},i.a.t("passwordRandomNumbers"))),o.a.createElement("div",{className:"form-group form-check"},o.a.createElement("input",{type:"checkbox",className:"form-check-input",id:"special",onChange:function(t){return e.toggleParam(t,"special")},checked:this.state.element.params.special}),o.a.createElement("label",{className:"form-check-label",htmlFor:"special"},i.a.t("passwordRandomSpecial"))),o.a.createElement("div",{className:"form-group form-check"},o.a.createElement("input",{type:"checkbox",className:"form-check-input",id:"spaces",onChange:function(t){return e.toggleParam(t,"spaces")},checked:this.state.element.params.spaces}),o.a.createElement("label",{className:"form-check-label",htmlFor:"spaces"},i.a.t("passwordRandomSpaces"))),o.a.createElement("div",{className:"form-group form-check"},o.a.createElement("input",{type:"checkbox",className:"form-check-input",id:"noSimilarFollowingChars",onChange:function(t){return e.toggleParam(t,"noSimilarFollowingChars")},checked:this.state.element.params.noSimilarFollowingChars}),o.a.createElement("label",{className:"form-check-label",htmlFor:"noSimilarFollowingChars"},i.a.t("passwordNoSimilarFollowingChars"))),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"passwordCharLength",className:"form-label"},i.a.t("passwordCharLength")),o.a.createElement("input",{type:"number",step:"1",min:"0",className:"form-control",id:"passwordCharLength",value:this.state.element.params.passwordCharLength,onChange:this.changePasswordLength})),o.a.createElement("div",{className:"mb-3"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.generateRandomChars,disabled:!this.state.element.params.lowercase&&!this.state.element.params.upprcase&&!this.state.element.params.numbers&&!this.state.element.params.special||!this.state.element.params.passwordCharLength},i.a.t("passwordGenerate")))))),o.a.createElement("div",{className:"accordion-item"},o.a.createElement("h2",{className:"accordion-header",id:"headingTwo"},o.a.createElement("button",{className:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#passwordRandomWords","aria-expanded":a?"true":"false","aria-controls":"passwordRandomWords"},i.a.t("passwordRandomWords"))),o.a.createElement("div",{id:"passwordRandomWords",className:"accordion-collapse collapse"+(a?" show":""),"aria-labelledby":"headingTwo","data-bs-parent":"#passwordRandom"},o.a.createElement("div",{className:"accordion-body"},o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"passwordWordsNumber",className:"form-label"},i.a.t("passwordWordsNumber")),o.a.createElement("input",{type:"number",step:"1",min:"0",className:"form-control",id:"passwordWordsNumber",value:this.state.element.params.wordsNumber,onChange:this.changePasswordWordsNumber})),o.a.createElement("div",{className:"input-group mb-3"},o.a.createElement("label",{className:"input-group-text",htmlFor:"passwordWordsSeparator"},i.a.t("passwordWordsSeparator")),o.a.createElement("select",{className:"form-select",id:"passwordWordsSeparator",value:this.state.element.params.wordSeparator,onChange:this.changePasswordWordsSeparator},o.a.createElement("option",{value:" "},i.a.t("passwordWordsSeparatorSpace")),o.a.createElement("option",{value:"."},i.a.t("passwordWordsSeparatorDot")),o.a.createElement("option",{value:"-"},i.a.t("passwordWordsSeparatorDash")),o.a.createElement("option",{value:"_"},i.a.t("passwordWordsSeparatorUnderscore")),o.a.createElement("option",{value:","},i.a.t("passwordWordsSeparatorComma")),o.a.createElement("option",{value:""},i.a.t("passwordWordsSeparatorNone")))),o.a.createElement("h5",null,i.a.t("passwordWordsLangs")),r,o.a.createElement("div",{className:"mb-3"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.generateRandomWords,disabled:!this.state.element.params.wordsNumber||!this.state.element.params.wordsLangsList.length},i.a.t("passwordGenerate"))))))),o.a.createElement("hr",null),o.a.createElement("div",{className:"mb-3"},n),o.a.createElement("div",{className:"mb-3"},o.a.createElement("div",{className:"btn-toolbar justify-content-between",role:"toolbar"},o.a.createElement("div",{className:"btn-group",role:"group"},o.a.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:this.toggleShowPassword,title:i.a.t("coinElementShowPassword"),disabled:!this.state.passwordGenerated},o.a.createElement("i",{className:"fa fa-eye","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:this.copyNewPassword,title:i.a.t("passwordCopyNewPassword"),disabled:!this.state.passwordGenerated},o.a.createElement("i",{className:"fa fa-files-o","aria-hidden":"true"}))),o.a.createElement("div",{className:"btn-group",role:"group"},o.a.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:this.copyOriginalPassword,title:i.a.t("passwordCopyOriginalPassword"),disabled:!this.state.originalPassword},o.a.createElement("i",{className:"fa fa-files-o","aria-hidden":"true"})))))),o.a.createElement("div",{className:"modal-footer"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.closeModal(t,!1)}},i.a.t("modalClose")),o.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:function(t){return e.closeModal(t,!0)},disabled:!this.state.passwordGenerated},i.a.t("modalCloseAndSave"))))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function Ct(e){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ot(e,t){return(Ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ot(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Tt(e);if(t){var o=Tt(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Ct(t)&&"function"!=typeof t?Pt(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,coin:e.coin,element:e.element,index:e.index,cbSave:e.cbSave,cbCancel:e.cbCancel,isDraggable:e.isDraggable,cbOnDragStart:e.cbOnDragStart,cbOnDragOver:e.cbOnDragOver,password:"",passwordConfirm:"",showModalGeneratePassword:!1,modalElement:!1,originalPassword:!1,pwdScore:-1},n.changePassword=n.changePassword.bind(Pt(n)),n.changePasswordConfirm=n.changePasswordConfirm.bind(Pt(n)),n.closeAndSave=n.closeAndSave.bind(Pt(n)),n.openGenerateModal=n.openGenerateModal.bind(Pt(n)),n.getGeneratedPassword=n.getGeneratedPassword.bind(Pt(n)),n}return function(e,t,a){t&&Nt(e.prototype,t),a&&Nt(e,a)}(a,[{key:"changePassword",value:function(e){var t=-1;e.target.value&&(t=zxcvbn(e.target.value).score),this.setState({password:e.target.value,pwdScore:t})}},{key:"changePasswordConfirm",value:function(e){this.setState({passwordConfirm:e.target.value})}},{key:"closeAndSave",value:function(e){if(this.state.password&&this.state.password===this.state.passwordConfirm){var t=this.state.element;t.value=this.state.password,this.state.cbSave(e,t,this.state.index)}}},{key:"openGenerateModal",value:function(){var e=Object.assign({},this.state.element);e.params||(e.params={type:"chars",lowercase:!0,upprcase:!0,numbers:!0,special:!0,spaces:!0,noSimilarFollowingChars:!1,passwordCharLength:32,wordsNumber:4,wordsLangsList:[i.a.language],wordSeparator:" "}),this.setState({showModalGeneratePassword:!0,modalElement:e,originalPassword:this.state.element.value},(function(){new bootstrap.Modal(document.getElementById("modalGeneratePassword"),{keyboard:!1}).show()}))}},{key:"getGeneratedPassword",value:function(e,t){var a=this;if(e){var n=-1;n=zxcvbn(t.value).score,navigator.clipboard.writeText(t.value).then((function(){$.snack("info",i.a.t("messageCopyToClipboard")),a.state.cbSave(!1,t,a.state.index)}))}bootstrap.Modal.getOrCreateInstance(document.querySelector("#modalGeneratePassword")).hide(),this.setState({showModalGeneratePassword:!1,modalElement:!1,originalPassword:!1,pwdScore:n})}},{key:"render",value:function(){var e,t,a=this;return this.state.showModalGeneratePassword&&(e=o.a.createElement(kt,{config:this.state.config,element:this.state.modalElement,originalPassword:this.state.originalPassword,callback:this.getGeneratedPassword})),0===this.state.pwdScore?t=o.a.createElement("span",{className:"badge bg-danger"},i.a.t("pwdScoreTooGuessable")):1===this.state.pwdScore?t=o.a.createElement("span",{className:"badge bg-warning"},i.a.t("pwdScoreVeryGuessable")):2===this.state.pwdScore?t=o.a.createElement("span",{className:"badge bg-secondary"},i.a.t("pwdScoreSomewhatGuessable")):3===this.state.pwdScore?t=o.a.createElement("span",{className:"badge bg-primary"},i.a.t("pwdScoreSafelyUnguessable")):4===this.state.pwdScore&&(t=o.a.createElement("span",{className:"badge bg-success"},i.a.t("pwdScoreVeryUnguessable"))),o.a.createElement("div",{draggable:this.state.isDraggable,onDragStart:this.state.cbOnDragStart,onDragOver:this.state.cbOnDragOver,id:this.state.coin.name+"-"+this.state.index},o.a.createElement("form",{onSubmit:function(e){return a.state.cbSave(e,a.state.element,a.state.index)}},o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:this.state.coin.name+"-"+this.state.index,className:"form-label"},i.a.t("coinElementPassword")),o.a.createElement("input",{type:"password",className:"form-control",id:this.state.coin.name+"-"+this.state.index,value:this.state.password,onChange:this.changePassword}),t),o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:this.state.coin.name+"-"+this.state.index,className:"form-label"},i.a.t("coinElementPasswordConfirm")),o.a.createElement("input",{type:"password",className:"form-control",id:this.state.coin.name+"-"+this.state.index+"-confirm",value:this.state.passwordConfirm,onChange:this.changePasswordConfirm})),o.a.createElement("div",{className:"mb-3"},o.a.createElement("div",{className:"btn-group"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(e){return a.state.cbCancel(e,a.state.index)}},i.a.t("modalClose")),o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:function(e){return a.closeAndSave(e)},disabled:!this.state.password||this.state.password!==this.state.passwordConfirm},i.a.t("modalOk"))),o.a.createElement("div",{className:"btn-group float-end"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.openGenerateModal,title:i.a.t("coinPasswordGenerate")},o.a.createElement("i",{className:"fa fa-magic","aria-hidden":"true"})))),e))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function _t(e){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function jt(e,t){return(jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Dt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kt(e){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Lt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jt(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Kt(e);if(t){var o=Kt(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==_t(t)&&"function"!=typeof t?Dt(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={coin:e.coin,element:e.element,index:e.index,cbSave:e.cbSave,cbCancel:e.cbCancel,isDraggable:e.isDraggable,cbOnDragStart:e.cbOnDragStart,cbOnDragOver:e.cbOnDragOver},n.getFile=n.getFile.bind(Dt(n)),n}return function(e,t,a){t&&Rt(e.prototype,t),a&&Rt(e,a)}(a,[{key:"getFile",value:function(e){var t=this,a=this.state.element,n=e.target.files[0],o=new FileReader;o.onload=function(e){a.value={filename:n.name,data:btoa(e.target.result)},t.setState({element:a})},o.readAsBinaryString(n)}},{key:"render",value:function(){var e,t=this;return this.state.element.value.filename&&(e=o.a.createElement("code",{className:"btn-icon-right"},this.state.element.value.filename)),o.a.createElement("div",{draggable:this.state.isDraggable,onDragStart:this.state.cbOnDragStart,onDragOver:this.state.cbOnDragOver,id:this.state.coin.name+"-"+this.state.index},o.a.createElement("form",{onSubmit:function(e){return t.state.cbSave(e,t.state.element,t.state.index)}},o.a.createElement("div",{className:"mb-3"},o.a.createElement("input",{type:"file",className:"upload",id:this.state.coin.name+"-"+this.state.index,onChange:this.getFile}),o.a.createElement("label",{htmlFor:this.state.coin.name+"-"+this.state.index,className:"btn btn-outline-secondary btn-sm"},o.a.createElement("i",{className:"fa fa-cloud-upload","aria-hidden":"true"})),e),o.a.createElement("div",{className:"mb-3 btn-group"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(e){return t.state.cbCancel(e,t.state.index)}},i.a.t("modalClose")),o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:function(e){return t.state.cbSave(e,t.state.element,t.state.index)},disabled:!this.state.element.value},i.a.t("modalOk")))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function Mt(e){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function It(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ft(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bt(e){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ut=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Bt(e);if(t){var o=Bt(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Mt(t)&&"function"!=typeof t?Ft(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={coin:e.coin,element:e.element,index:e.index,cbSave:e.cbSave,cbCancel:e.cbCancel,isDraggable:e.isDraggable,cbOnDragStart:e.cbOnDragStart,cbOnDragOver:e.cbOnDragOver},n.changeValue=n.changeValue.bind(Ft(n)),n}return function(e,t,a){t&&It(e.prototype,t),a&&It(e,a)}(a,[{key:"changeValue",value:function(e){var t=this.state.element;t.value=e.target.value,this.setState({element:t})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{draggable:this.state.isDraggable,onDragStart:this.state.cbOnDragStart,onDragOver:this.state.cbOnDragOver,id:this.state.coin.name+"-"+this.state.index},o.a.createElement("form",{onSubmit:function(t){return e.state.cbSave(t,e.state.element,e.state.index)}},o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:this.state.coin.name+"-"+this.state.index,className:"form-label"},i.a.t("coinElementMisc")),o.a.createElement("input",{type:"text",className:"form-control",id:this.state.coin.name+"-"+this.state.index,value:this.state.element.value,placeholder:i.a.t("coinElementMiscPh"),onChange:this.changeValue})),o.a.createElement("div",{className:"mb-3 btn-group"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.state.cbCancel(t,e.state.index)}},i.a.t("modalClose")),o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:function(t){return e.state.cbSave(t,e.state.element,e.state.index)},disabled:!this.state.element.value},i.a.t("modalOk")))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function Wt(e){return(Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $t(e,t){return($t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Gt(e){return(Gt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var qt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$t(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Gt(e);if(t){var o=Gt(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Wt(t)&&"function"!=typeof t?Vt(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={coin:e.coin,element:e.element,index:e.index,cbEdit:e.cbEdit,cbRemove:e.cbRemove,cbTags:e.cbTags,isDraggable:e.isDraggable,cbOnDragStart:e.cbOnDragStart,cbOnDragOver:e.cbOnDragOver},n.copyToClipboard=n.copyToClipboard.bind(Vt(n)),n}return function(e,t,a){t&&Jt(e.prototype,t),a&&Jt(e,a)}(a,[{key:"copyToClipboard",value:function(){navigator.clipboard.writeText(this.state.element.value).then((function(){$.snack("info",i.a.t("messageCopyToClipboard"))}))}},{key:"render",value:function(){var e=this,t=[];return this.state.element.tags&&this.state.element.tags.forEach((function(e,a){t.push(o.a.createElement("span",{key:a,className:"badge rounded-pill bg-secondary btn-icon"},e))})),o.a.createElement("div",{draggable:this.state.isDraggable,onDragStart:this.state.cbOnDragStart,onDragOver:this.state.cbOnDragOver,id:this.state.coin.name+"-"+this.state.index},o.a.createElement("div",{className:"row btn-icon-bottom"},o.a.createElement("div",{className:"col"},o.a.createElement("span",{className:"btn-icon-right"},o.a.createElement("span",{className:"badge bg-primary"},i.a.t("coinElementUrl")))),o.a.createElement("div",{className:"col text-truncate"},o.a.createElement("span",{className:"btn-icon-right"},o.a.createElement("a",{href:this.state.element.value,target:"_blank",title:this.state.element.value,className:"link-secondary"},this.state.element.value))),o.a.createElement("div",{className:"col"},o.a.createElement("div",{className:"btn-group float-end btn-icon",role:"group"},o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementCopy"),onClick:this.copyToClipboard},o.a.createElement("i",{className:"fa fa-files-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementEdit"),onClick:function(t){return e.state.cbEdit(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementRemove"),onClick:function(t){return e.state.cbRemove(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementTags"),onClick:function(t){return e.state.cbTags(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-tags","aria-hidden":"true"}))))),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},t)))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function Ht(e){return(Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function zt(e,t){return(zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yt(e){return(Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Zt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zt(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Yt(e);if(t){var o=Yt(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Ht(t)&&"function"!=typeof t?Xt(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={coin:e.coin,element:e.element,index:e.index,cbEdit:e.cbEdit,cbRemove:e.cbRemove,cbTags:e.cbTags,isDraggable:e.isDraggable,cbOnDragStart:e.cbOnDragStart,cbOnDragOver:e.cbOnDragOver},n.copyToClipboard=n.copyToClipboard.bind(Xt(n)),n}return function(e,t,a){t&&Qt(e.prototype,t),a&&Qt(e,a)}(a,[{key:"copyToClipboard",value:function(){navigator.clipboard.writeText(this.state.element.value).then((function(){$.snack("info",i.a.t("messageCopyToClipboard"))}))}},{key:"render",value:function(){var e=this,t=[];return this.state.element.tags&&this.state.element.tags.forEach((function(e,a){t.push(o.a.createElement("span",{key:a,className:"badge rounded-pill bg-secondary btn-icon"},e))})),o.a.createElement("div",{draggable:this.state.isDraggable,onDragStart:this.state.cbOnDragStart,onDragOver:this.state.cbOnDragOver,id:this.state.coin.name+"-"+this.state.index},o.a.createElement("div",{className:"row btn-icon-bottom"},o.a.createElement("div",{className:"col"},o.a.createElement("span",{className:"btn-icon-right"},o.a.createElement("span",{className:"badge bg-primary"},i.a.t("coinElementLogin")))),o.a.createElement("div",{className:"col text-truncate"},o.a.createElement("span",{className:"btn-icon-right"},this.state.element.value)),o.a.createElement("div",{className:"col"},o.a.createElement("div",{className:"btn-group float-end btn-icon",role:"group"},o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementCopy"),onClick:this.copyToClipboard},o.a.createElement("i",{className:"fa fa-files-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementEdit"),onClick:function(t){return e.state.cbEdit(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementRemove"),onClick:function(t){return e.state.cbRemove(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementTags"),onClick:function(t){return e.state.cbTags(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-tags","aria-hidden":"true"}))))),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},t)))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function ea(e){return(ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ta(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function aa(e,t){return(aa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function na(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oa(e){return(oa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ra=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&aa(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=oa(e);if(t){var o=oa(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==ea(t)&&"function"!=typeof t?na(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={coin:e.coin,element:e.element,index:e.index,cbEdit:e.cbEdit,cbRemove:e.cbRemove,cbTags:e.cbTags,isDraggable:e.isDraggable,cbOnDragStart:e.cbOnDragStart,cbOnDragOver:e.cbOnDragOver,showPassword:!1},n.copyToClipboard=n.copyToClipboard.bind(na(n)),n.toggleShowPassword=n.toggleShowPassword.bind(na(n)),n}return function(e,t,a){t&&ta(e.prototype,t),a&&ta(e,a)}(a,[{key:"copyToClipboard",value:function(){navigator.clipboard.writeText(this.state.element.value).then((function(){$.snack("info",i.a.t("messageCopyToClipboard"))}))}},{key:"toggleShowPassword",value:function(e){e.preventDefault(),this.setState({showPassword:!this.state.showPassword})}},{key:"render",value:function(){var e,t=this,a=[];return this.state.element.tags&&this.state.element.tags.forEach((function(e,t){a.push(o.a.createElement("span",{key:t,className:"badge rounded-pill bg-secondary btn-icon"},e))})),e=this.state.showPassword?o.a.createElement("code",null,this.state.element.value):o.a.createElement("span",{className:"btn-icon-right"},"********"),o.a.createElement("div",{draggable:this.state.isDraggable,onDragStart:this.state.cbOnDragStart,onDragOver:this.state.cbOnDragOver,id:this.state.coin.name+"-"+this.state.index},o.a.createElement("div",{className:"row btn-icon-bottom"},o.a.createElement("div",{className:"col text-truncate"},o.a.createElement("span",{className:"btn-icon-right"},o.a.createElement("span",{className:"badge bg-primary"},i.a.t("coinElementPassword")))),o.a.createElement("div",{className:"col text-truncate"},e),o.a.createElement("div",{className:"col"},o.a.createElement("div",{className:"btn-group float-end btn-icon",role:"group"},o.a.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",title:i.a.t("coinElementShowPassword"),onClick:this.toggleShowPassword},o.a.createElement("i",{className:"fa fa-eye","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementCopy"),onClick:this.copyToClipboard},o.a.createElement("i",{className:"fa fa-files-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementEdit"),onClick:function(e){return t.state.cbEdit(e,t.state.index)}},o.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementRemove"),onClick:function(e){return t.state.cbRemove(e,t.state.index)}},o.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementTags"),onClick:function(e){return t.state.cbTags(e,t.state.index)}},o.a.createElement("i",{className:"fa fa-tags","aria-hidden":"true"}))))),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},a)))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function sa(e){return(sa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ia(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ca(e,t){return(ca=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function la(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ua(e){return(ua=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var fa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ca(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=ua(e);if(t){var o=ua(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==sa(t)&&"function"!=typeof t?la(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={value:e.value,index:e.index,cbSave:e.cbSave,disableEdit:e.disableEdit,showAnswer:!1},n.copyToClipboard=n.copyToClipboard.bind(la(n)),n.toggleShowAnswer=n.toggleShowAnswer.bind(la(n)),n}return function(e,t,a){t&&ia(e.prototype,t),a&&ia(e,a)}(a,[{key:"copyToClipboard",value:function(){navigator.clipboard.writeText(this.state.value.answer).then((function(){$.snack("info",i.a.t("messageCopyToClipboard"))}))}},{key:"toggleShowAnswer",value:function(){this.setState({showAnswer:!this.state.showAnswer})}},{key:"render",value:function(){var e,t=this;return e=this.state.value.answer.length>4&&!this.state.showAnswer?this.state.value.answer.substring(0,2)+"[...]"+this.state.value.answer.slice(-2):this.state.value.answer,o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},o.a.createElement("span",{className:"badge bg-info text-dark"},i.a.t("coinElementQuestionQ")),o.a.createElement("code",{className:"btn-icon-right"},this.state.value.question)),o.a.createElement("div",{className:"col"},o.a.createElement("span",{className:"badge bg-info text-dark"},i.a.t("coinElementQuestionA")),o.a.createElement("code",{className:"btn-icon-right"},e)),o.a.createElement("div",{className:"col"},o.a.createElement("div",{className:"btn-group float-end btn-icon",role:"group"},o.a.createElement("button",{type:"button",className:"btn btn-outline-secondary btn-sm",title:i.a.t("coinElementShowAnswer"),onClick:this.toggleShowAnswer},o.a.createElement("i",{className:"fa fa-eye","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementCopy"),onClick:this.copyToClipboard},o.a.createElement("i",{className:"fa fa-files-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementEdit"),onClick:function(e){return t.state.cbEdit(e,t.state.index)},disabled:this.state.disableEdit},o.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementRemove"),onClick:function(e){return t.state.cbRemove(e,t.state.index)}},o.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true"})))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function ma(e){return(ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function da(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function pa(e,t){return(pa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ha(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ba(e){return(ba=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ya=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pa(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=ba(e);if(t){var o=ba(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==ma(t)&&"function"!=typeof t?ha(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={value:e.value,index:e.index,wordsList:e.wordsList,cbSave:e.cbSave,cbCancel:e.cbCancel},n.changeQuestion=n.changeQuestion.bind(ha(n)),n.changeAnswer=n.changeAnswer.bind(ha(n)),n.generateAnswer=n.generateAnswer.bind(ha(n)),n}return function(e,t,a){t&&da(e.prototype,t),a&&da(e,a)}(a,[{key:"changeQuestion",value:function(e){var t=this.state.value;t.question=e.target.value,this.setState({value:t})}},{key:"changeAnswer",value:function(e){var t=this.state.value;t.answer=e.target.value,this.setState({value:t})}},{key:"randomWordsRangeList",value:function(e,t){var a=new Uint32Array(e);window.crypto.getRandomValues(a);for(var n=0;n<e;n++)for(;a[n]>=t;){var o=new Uint32Array(1);window.crypto.getRandomValues(o),a[n]=o[0]}return a}},{key:"generateAnswer",value:function(){var e=this.randomWordsRangeList(2,this.state.wordsList.length),t=this.state.wordsList[e[0]]+" "+this.state.wordsList[e[1]],a=this.state.value;a.answer=t,this.setState({value:a})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},o.a.createElement("div",{className:"input-group mb-3"},o.a.createElement("span",{className:"input-group-text",id:"basic-addon1"},i.a.t("coinElementQuestionQ")),o.a.createElement("input",{type:"text",className:"form-control",placeholder:i.a.t("coinElementQuestionQPH"),value:this.state.value.question,onChange:this.changeQuestion})))),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},o.a.createElement("div",{className:"input-group mb-3"},o.a.createElement("span",{className:"input-group-text",id:"basic-addon1"},i.a.t("coinElementQuestionA")),o.a.createElement("input",{type:"text",className:"form-control",placeholder:i.a.t("coinElementQuestionAPH"),value:this.state.value.answer,onChange:this.changeAnswer}),o.a.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:this.generateAnswer},o.a.createElement("i",{className:"fa fa-magic","aria-hidden":"true"}))))),o.a.createElement("div",{className:"mb-3 btn-group"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.state.cbCancel(t,e.state.index)}},i.a.t("modalCancel")),o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:function(t){return e.state.cbSave(t,e.state.value,e.state.index)},disabled:!this.state.value.answer},i.a.t("modalOk"))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function ga(e){return(ga="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function va(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ea(e,t){return(Ea=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function wa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Sa(e){return(Sa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ka=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ea(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Sa(e);if(t){var o=Sa(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==ga(t)&&"function"!=typeof t?wa(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={coin:e.coin,element:e.element,index:e.index,closeButon:e.closeButon,editList:[],cbRemove:e.cbRemove,cbSave:e.cbSave,cbTags:e.cbTags,isDraggable:e.isDraggable,cbOnDragStart:e.cbOnDragStart,cbOnDragOver:e.cbOnDragOver},n.copyToClipboard=n.copyToClipboard.bind(wa(n)),n.saveRow=n.saveRow.bind(wa(n)),n.cancelRow=n.cancelRow.bind(wa(n)),n.editRow=n.editRow.bind(wa(n)),n.removeRow=n.removeRow.bind(wa(n)),n.cbAddQuestion=n.cbAddQuestion.bind(wa(n)),n}return function(e,t,a){t&&va(e.prototype,t),a&&va(e,a)}(a,[{key:"copyToClipboard",value:function(e){navigator.clipboard.writeText(this.state.element.value[e].answer).then((function(){$.snack("info",i.a.t("messageCopyToClipboard"))}))}},{key:"saveRow",value:function(e,t,a){var n=this,o=this.state.element;o.value[a]?o.value[a]=t:o.value.push(t);var r=this.state.editList;-1!==r.indexOf(a)&&r.splice(r.indexOf(a),1),this.setState({element:o,editList:r},(function(){n.state.cbSave(e,n.state.element,n.state.index)}))}},{key:"cancelRow",value:function(e,t){var a=this.state.editList;-1!==a.indexOf(t)&&a.splice(a.indexOf(t),1),this.setState({editList:a})}},{key:"editRow",value:function(e,t){var a=this.state.editList;a.push(t),this.setState({editList:a})}},{key:"removeRow",value:function(e,t){var a=this,n=this.state.element;n.value.splice(t,1);var o=this.state.editList;-1!==o.indexOf(t)&&o.splice(o.indexOf(t),1),this.setState({editList:o,element:n},(function(){a.state.cbSave(e,a.state.element,a.state.index)}))}},{key:"cbAddQuestion",value:function(){var e=this.state.editList,t=this.state.element;e.push(t.value.length),t.value.push({question:"",answer:""}),this.setState({editList:e,element:t})}},{key:"render",value:function(){var e,t=this,a=[],n=[];return this.state.element.tags&&this.state.element.tags.forEach((function(e,t){a.push(o.a.createElement("span",{key:t,className:"badge rounded-pill bg-secondary btn-icon"},e))})),this.state.element.value.length?this.state.element.value.forEach((function(e,a){-1!==t.state.editList.indexOf(a)?n.push(o.a.createElement(ya,{value:Object.assign({},e),index:a,wordsList:t.state.config.wordsList,cbSave:t.saveRow,cbCancel:t.cancelRow,key:a})):n.push(o.a.createElement(fa,{value:Object.assign({},e),index:a,cbEdit:function(e){return t.editRow(e,a)},cbRemove:function(e){return t.removeRow(e,a)},key:a,disableEdit:!!t.state.editList.length}))})):n.push(o.a.createElement(ya,{value:{question:"",answer:""},index:0,wordsList:this.state.config.wordsList,cbSave:this.saveRow,cbCancel:this.cancelRow,key:-1})),this.state.closeButon&&(e=o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},o.a.createElement("div",{className:"btn-group float-end btn-icon",role:"group"},o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("modalClose"),onClick:function(e){return t.state.cbSave(e,t.state.element,t.state.index)}},i.a.t("modalClose")))))),o.a.createElement("div",{draggable:this.state.isDraggable,onDragStart:this.state.cbOnDragStart,onDragOver:this.state.cbOnDragOver,id:this.state.coin.name+"-"+this.state.index},o.a.createElement("div",{className:"row btn-icon-bottom"},o.a.createElement("div",{className:"col"},o.a.createElement("span",{className:"btn-icon-right"},o.a.createElement("span",{className:"badge bg-primary"},i.a.t("coinElementSecretQuestions")))),o.a.createElement("div",{className:"col"},o.a.createElement("div",{className:"btn-group float-end btn-icon",role:"group"},o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementAddQuestion"),onClick:this.cbAddQuestion,disabled:this.state.editList.length},o.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementRemove"),onClick:function(e){return t.state.cbRemove(e,t.state.index)}},o.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementTags"),onClick:function(e){return t.state.cbTags(e,t.state.index)}},o.a.createElement("i",{className:"fa fa-tags","aria-hidden":"true"}))))),n,o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},a)),e)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function Ca(e){return(Ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Na(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Oa(e,t){return(Oa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ta(e){return(Ta=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oa(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Ta(e);if(t){var o=Ta(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Ca(t)&&"function"!=typeof t?Pa(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={coin:e.coin,element:e.element,index:e.index,cbEdit:e.cbEdit,cbRemove:e.cbRemove,cbTags:e.cbTags,isDraggable:e.isDraggable,cbOnDragStart:e.cbOnDragStart,cbOnDragOver:e.cbOnDragOver},n.downloadFile=n.downloadFile.bind(Pa(n)),n}return function(e,t,a){t&&Na(e.prototype,t),a&&Na(e,a)}(a,[{key:"downloadFile",value:function(){if(this.state.element.value.data){var e=$("#"+this.state.coin.name+"-"+this.state.index+"-download");e.attr("href","data:application/octet-stream;base64,"+this.state.element.value.data),e[0].click()}}},{key:"render",value:function(){var e=this,t=[];return this.state.element.tags&&this.state.element.tags.forEach((function(e,a){t.push(o.a.createElement("span",{key:a,className:"badge rounded-pill bg-secondary btn-icon"},e))})),o.a.createElement("div",{draggable:this.state.isDraggable,onDragStart:this.state.cbOnDragStart,onDragOver:this.state.cbOnDragOver,id:this.state.coin.name+"-"+this.state.index},o.a.createElement("div",{className:"row btn-icon-bottom"},o.a.createElement("div",{className:"col"},o.a.createElement("span",{className:"btn-icon-right"},o.a.createElement("span",{className:"badge bg-primary"},i.a.t("coinElementFile")))),o.a.createElement("div",{className:"col text-truncate"},o.a.createElement("span",{className:"btn-icon-right"},o.a.createElement("code",null,this.state.element.value.filename))),o.a.createElement("div",{className:"col"},o.a.createElement("div",{className:"btn-group float-end btn-icon",role:"group"},o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementDownload"),onClick:this.downloadFile},o.a.createElement("i",{className:"fa fa-cloud-download","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementEdit"),onClick:function(t){return e.state.cbEdit(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementRemove"),onClick:function(t){return e.state.cbRemove(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementTags"),onClick:function(t){return e.state.cbTags(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-tags","aria-hidden":"true"}))))),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},t)),o.a.createElement("a",{className:"upload",id:this.state.coin.name+"-"+this.state.index+"-download",download:this.state.element.value.filename}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function _a(e){return(_a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ra(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ja(e,t){return(ja=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Da(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ka(e){return(Ka=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var La=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ja(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Ka(e);if(t){var o=Ka(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==_a(t)&&"function"!=typeof t?Da(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={coin:e.coin,element:e.element,index:e.index,cbEdit:e.cbEdit,cbRemove:e.cbRemove,cbTags:e.cbTags,isDraggable:e.isDraggable,cbOnDragStart:e.cbOnDragStart,cbOnDragOver:e.cbOnDragOver},n.copyToClipboard=n.copyToClipboard.bind(Da(n)),n}return function(e,t,a){t&&Ra(e.prototype,t),a&&Ra(e,a)}(a,[{key:"copyToClipboard",value:function(){navigator.clipboard.writeText(this.state.element.value).then((function(){$.snack("info",i.a.t("messageCopyToClipboard"))}))}},{key:"render",value:function(){var e=this,t=[];return this.state.element.tags&&this.state.element.tags.forEach((function(e,a){t.push(o.a.createElement("span",{key:a,className:"badge rounded-pill bg-secondary btn-icon"},e))})),o.a.createElement("div",{draggable:this.state.isDraggable,onDragStart:this.state.cbOnDragStart,onDragOver:this.state.cbOnDragOver,id:this.state.coin.name+"-"+this.state.index},o.a.createElement("div",{className:"row btn-icon-bottom"},o.a.createElement("div",{className:"col"},o.a.createElement("span",{className:"btn-icon-right"},o.a.createElement("span",{className:"badge bg-primary"},i.a.t("coinElementMisc")))),o.a.createElement("div",{className:"col text-truncate"},o.a.createElement("span",{className:"btn-icon-right"},o.a.createElement("code",null,this.state.element.value))),o.a.createElement("div",{className:"col"},o.a.createElement("div",{className:"btn-group float-end btn-icon",role:"group"},o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementCopy"),onClick:this.copyToClipboard},o.a.createElement("i",{className:"fa fa-files-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementEdit"),onClick:function(t){return e.state.cbEdit(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementRemove"),onClick:function(t){return e.state.cbRemove(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true"})),o.a.createElement("button",{className:"btn btn-outline-secondary btn-sm",type:"button",title:i.a.t("coinElementTags"),onClick:function(t){return e.state.cbTags(t,e.state.index)}},o.a.createElement("i",{className:"fa fa-tags","aria-hidden":"true"}))))),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col"},t)))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function Ma(e){return(Ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ia(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Aa(e,t){return(Aa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ba(e){return(Ba=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ua=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Aa(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Ba(e);if(t){var o=Ba(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Ma(t)&&"function"!=typeof t?Fa(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={index:e.index,tags:e.tags,cb:e.cb,inputValue:""},n.addTag=n.addTag.bind(Fa(n)),n.deleteTag=n.deleteTag.bind(Fa(n)),n.submitForm=n.submitForm.bind(Fa(n)),n.changeInputValue=n.changeInputValue.bind(Fa(n)),n}return function(e,t,a){t&&Ia(e.prototype,t),a&&Ia(e,a)}(a,[{key:"closeModal",value:function(e,t){this.state.cb&&this.state.cb(t,this.state.tags)}},{key:"changeInputValue",value:function(e){/\s/.test(e.target.value)?this.addTag():this.setState({inputValue:e.target.value})}},{key:"addTag",value:function(){var e=this.state.tags;return this.state.inputValue&&e.push(this.state.inputValue),this.setState({tags:e,inputValue:""})}},{key:"deleteTag",value:function(e,t){e.preventDefault();var a=this.state.tags;a.splice(t,1),this.setState({tags:a})}},{key:"submitForm",value:function(e){var t=this;e.preventDefault();var a=this.state.tags;this.state.inputValue&&a.push(this.state.inputValue),this.setState({tags:a,inputValue:""},(function(){t.closeModal(e,!0)}))}},{key:"render",value:function(){var e=this,t=[];return this.state.tags.forEach((function(a,n){t.push(o.a.createElement("a",{href:"#",onClick:function(t){return e.deleteTag(t,n)},key:n},o.a.createElement("span",{className:"badge rounded-pill bg-secondary btn-icon"},a,o.a.createElement("span",{className:"badge badge-light btn-icon-right"},o.a.createElement("i",{className:"fas fa-times"})))))})),o.a.createElement("div",{className:"modal",tabIndex:"-1",id:"modalCoinElementTags"},o.a.createElement("div",{className:"modal-dialog"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"modal-header"},o.a.createElement("h5",{className:"modal-title"},i.a.t("CoinElementTags")),o.a.createElement("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:function(t){return e.closeModal(t,!1)}})),o.a.createElement("form",{onSubmit:function(t){return e.submitForm(t)}},o.a.createElement("div",{className:"modal-body"},o.a.createElement("div",{className:"mb-3"},o.a.createElement("label",{htmlFor:"coinDisplayName",className:"form-label"},i.a.t("coinDisplayName")),o.a.createElement("div",{className:"input-group mb-3"},o.a.createElement("input",{type:"text",maxLength:"128",className:"form-control",id:"coinDisplayName",value:this.state.inputValue,onChange:function(t){return e.changeInputValue(t)}}),o.a.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:this.addTag},o.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"}))),t)),o.a.createElement("div",{className:"modal-footer"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.closeModal(t,!1)}},i.a.t("modalClose")),o.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:function(t){return e.submitForm(t)}},i.a.t("modalOk")))))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function Wa(e){return(Wa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ja(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $a(e,t){return($a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Va(e){return(Va=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ga=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$a(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Va(e);if(t){var o=Va(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Wa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,cb:e.cb,safe:e.safe,coin:e.coin},n}return function(e,t,a){t&&Ja(e.prototype,t),a&&Ja(e,a)}(a,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"modal",tabIndex:"-1",id:"exportCoinModal"},o.a.createElement("div",{className:"modal-dialog"},o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"modal-header"},o.a.createElement("h5",{className:"modal-title"},i.a.t("exportCoin")),o.a.createElement("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:function(t){return e.state.cb(t)}})),o.a.createElement("div",{className:"modal-body"},o.a.createElement(Ze,{config:this.state.config,safe:this.state.safe,content:[this.state.coin],id:this.state.coin.name,name:this.state.coin.data.displayName})),o.a.createElement("div",{className:"modal-footer"},o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){return e.state.cb(t)}},i.a.t("modalClose"))))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function qa(e){return(qa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ha(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qa(e,t){return(Qa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function za(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xa(e){return(Xa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ya=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qa(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Xa(e);if(t){var o=Xa(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==qa(t)&&"function"!=typeof t?za(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,safe:e.safe,coin:e.coin,cbEditHeader:e.cbEditHeader,cbRemoveCoin:e.cbRemoveCoin,cbSaveCoin:e.cbSaveCoin,showAddElement:!1,newElementType:!1,editElementList:[],curElementIndex:-1,showConfirm:!1,showEditTags:!1,showExportCoin:!1,sortRowsEnabled:!1,overId:!1},n.exportCoin=n.exportCoin.bind(za(n)),n.exportCoinClose=n.exportCoinClose.bind(za(n)),n.addSecretElement=n.addSecretElement.bind(za(n)),n.cancelEditElement=n.cancelEditElement.bind(za(n)),n.editElement=n.editElement.bind(za(n)),n.removeElement=n.removeElement.bind(za(n)),n.removeElementConfirm=n.removeElementConfirm.bind(za(n)),n.setElementTags=n.setElementTags.bind(za(n)),n.setElementTagsConfirm=n.setElementTagsConfirm.bind(za(n)),n.saveElement=n.saveElement.bind(za(n)),n.onDrop=n.onDrop.bind(za(n)),n.onDragOver=n.onDragOver.bind(za(n)),n}return function(e,t,a){t&&Ha(e.prototype,t),a&&Ha(e,a)}(a,[{key:"exportCoin",value:function(){this.setState({showExportCoin:!0},(function(){new bootstrap.Modal(document.getElementById("exportCoinModal"),{keyboard:!1}).show()}))}},{key:"exportCoinClose",value:function(){bootstrap.Modal.getOrCreateInstance(document.querySelector("#exportCoinModal")).hide(),this.setState({showExportCoin:!1})}},{key:"addSecretElement",value:function(){this.setState({showAddElement:!0,newElementType:"url"})}},{key:"setNewElementType",value:function(e){this.setState({newElementType:e.target.value})}},{key:"editElement",value:function(e,t){e.preventDefault();var a=this.state.editElementList;a.push(t),this.setState({editElementList:a})}},{key:"removeElement",value:function(e,t){e.preventDefault(),this.setState({curElementIndex:t,showConfirm:!0},(function(){new bootstrap.Modal(document.getElementById("removeElement"),{keyboard:!1}).show()}))}},{key:"removeElementConfirm",value:function(e){if(e){var t=this.state.coin;t.data.rows.splice(this.state.curElementIndex,1),this.state.cbSaveCoin(!0,t.name,t.data,!0)}bootstrap.Modal.getOrCreateInstance(document.querySelector("#removeElement")).hide(),this.setState({showConfirm:!1})}},{key:"setElementTags",value:function(e,t){e.preventDefault(),this.setState({curElementIndex:t,curTags:this.state.coin.data.rows[t].tags||[],showEditTags:!0},(function(){new bootstrap.Modal(document.getElementById("modalCoinElementTags"),{keyboard:!1}).show()}))}},{key:"setElementTagsConfirm",value:function(e,t){if(e){var a=this.state.coin;t.length?a.data.rows[this.state.curElementIndex].tags=t:delete a.data.rows[this.state.curElementIndex].tags,this.state.cbSaveCoin(!0,a.name,a.data,!0)}bootstrap.Modal.getOrCreateInstance(document.querySelector("#modalCoinElementTags")).hide(),this.setState({showEditTags:!1})}},{key:"saveElement",value:function(e,t,a){var n=this,o=this.state.coin;-1===a?o.data.rows.push(t):(o.data.rows[a]=t,this.cancelEditElement(e,a)),this.setState({showAddElement:!1,newElementType:!1},(function(){n.state.cbSaveCoin(!0,o.name,o.data,!0)}))}},{key:"cancelEditElement",value:function(e,t){if(e&&e.preventDefault(),-1===t)this.setState({showAddElement:!1,newElementType:!1});else{var a=this.state.editElementList;a.indexOf(t)>-1&&a.splice(a.indexOf(t),1),this.setState({editElementList:a})}}},{key:"copyToClipboard",value:function(e){navigator.clipboard.writeText(e).then((function(){$.snack("info",i.a.t("messageCopyToClipboard"))}))}},{key:"sortRows",value:function(){var e=this;this.setState({sortRowsEnabled:!this.state.sortRowsEnabled},(function(){e.state.sortRowsEnabled?$.snack("info",i.a.t("messageSortEnabled")):$.snack("info",i.a.t("messageSortDisabled"))}))}},{key:"switchRows",value:function(e,t){var a=this.state.coin,n=a.data.rows[e];a.data.rows.splice(e,1),a.data.rows.splice(t,0,n),this.state.cbSaveCoin(!0,a.name,a.data,!0)}},{key:"onDragStart",value:function(e){e.dataTransfer.setData("text",e.target.id)}},{key:"onDrop",value:function(e){e.preventDefault();var t=e.dataTransfer.getData("text").split("-");t&&2===t.length&&t[0]===this.state.coin.name&&this.switchRows(parseInt(t[1]),parseInt(this.state.overId))}},{key:"onDragOver",value:function(e){for(var t=e.target;t;){if(t.draggable){var a=t.id.split("-");a&&2===a.length&&a[0]===this.state.coin.name&&this.setState({overId:a[1]});break}t=t.parentElement}e.preventDefault()}},{key:"render",value:function(){var e,t,a,n,r,s,c,l=this,u=[],f=[];switch(this.state.coin.data.icon&&(e=o.a.createElement("i",{className:this.state.coin.data.icon+" btn-icon","aria-hidden":"true"})),this.state.showAddElement&&(t=o.a.createElement("div",{className:"input-group mb-3"},o.a.createElement("span",{className:"input-group-text",id:"basic-addon1"},i.a.t("coinElementType")),o.a.createElement("select",{className:"form-select",id:"addElement",onChange:function(e){return l.setNewElementType(e)},value:this.state.newElementType},o.a.createElement("option",{value:"url"},i.a.t("coinElementTypeUrl")),o.a.createElement("option",{value:"login"},i.a.t("coinElementTypeLogin")),o.a.createElement("option",{value:"password"},i.a.t("coinElementTypePassword")),o.a.createElement("option",{value:"secretQuestion"},i.a.t("coinElementTypeSecretQuestion")),o.a.createElement("option",{value:"file"},i.a.t("coinElementTypeFile")),o.a.createElement("option",{value:"misc"},i.a.t("coinElementTypeMisc"))))),this.state.newElementType){case"url":a=o.a.createElement(ft,{coin:this.state.coin,element:{type:this.state.newElementType,value:""},index:-1,cbSave:this.saveElement,cbCancel:this.cancelEditElement}),n=o.a.createElement("hr",null);break;case"login":a=o.a.createElement(yt,{coin:this.state.coin,element:{type:this.state.newElementType,value:""},index:-1,cbSave:this.saveElement,cbCancel:this.cancelEditElement}),n=o.a.createElement("hr",null);break;case"password":a=o.a.createElement(xt,{config:this.state.config,coin:this.state.coin,element:{type:this.state.newElementType,value:""},index:-1,cbSave:this.saveElement,cbCancel:this.cancelEditElement}),n=o.a.createElement("hr",null);break;case"secretQuestion":a=o.a.createElement(ka,{config:this.state.config,coin:this.state.coin,element:{type:this.state.newElementType,value:[]},index:-1,closeButon:!0,cbSave:this.saveElement,cbRemove:this.removeElement,cbCancel:this.cancelEditElement,cbTags:function(e){return l.setElementTags(e,index)}}),n=o.a.createElement("hr",null);break;case"file":a=o.a.createElement(Lt,{coin:this.state.coin,element:{type:this.state.newElementType,value:{}},index:-1,cbSave:this.saveElement,cbCancel:this.cancelEditElement}),n=o.a.createElement("hr",null);break;case"misc":a=o.a.createElement(Ut,{coin:this.state.coin,element:{type:this.state.newElementType,value:""},index:-1,cbSave:this.saveElement,cbCancel:this.cancelEditElement}),n=o.a.createElement("hr",null)}this.state.showConfirm&&(r=o.a.createElement(Z,{name:"removeElement",title:i.a.t("removeElementTitle"),message:i.a.t("removeElementMessage"),cb:this.removeElementConfirm})),this.state.showEditTags&&(s=o.a.createElement(Ua,{index:this.state.curElementIndex,tags:this.state.curTags,cb:this.setElementTagsConfirm})),this.state.showExportCoin&&(c=o.a.createElement(Ga,{config:this.state.config,cb:this.exportCoinClose,safe:this.state.safe,coin:this.state.coin})),this.state.coin.data.rows.forEach((function(e,t){switch(e.type){case"url":-1===l.state.editElementList.indexOf(t)?u.push(o.a.createElement(qt,{key:t,coin:l.state.coin,element:e,index:t,cbEdit:l.editElement,cbRemove:l.removeElement,cbTags:function(e){return l.setElementTags(e,t)},isDraggable:l.state.sortRowsEnabled,cbOnDragStart:l.onDragStart,cbOnDragOver:l.onDragOver})):u.push(o.a.createElement(ft,{key:t,coin:l.state.coin,element:e,index:t,cbSave:l.saveElement,cbCancel:l.cancelEditElement,isDraggable:l.state.sortRowsEnabled,cbOnDragStart:l.onDragStart,cbOnDragOver:l.onDragOver}));break;case"login":f.push(o.a.createElement("button",{key:t,type:"button",className:"btn btn-secondary",onClick:function(t){return l.copyToClipboard(e.value)},title:(e.tags||[]).join(" ")},o.a.createElement("i",{className:"fa fa-user","aria-hidden":"true"}))),-1===l.state.editElementList.indexOf(t)?u.push(o.a.createElement(Zt,{key:t,coin:l.state.coin,element:e,index:t,cbEdit:l.editElement,cbRemove:l.removeElement,cbTags:function(e){return l.setElementTags(e,t)},isDraggable:l.state.sortRowsEnabled,cbOnDragStart:l.onDragStart,cbOnDragOver:l.onDragOver})):u.push(o.a.createElement(yt,{key:t,coin:l.state.coin,element:e,index:t,cbSave:l.saveElement,cbCancel:l.cancelEditElement,isDraggable:l.state.sortRowsEnabled,cbOnDragStart:l.onDragStart,cbOnDragOver:l.onDragOver}));break;case"password":f.push(o.a.createElement("button",{key:t,type:"button",className:"btn btn-secondary",onClick:function(t){return l.copyToClipboard(e.value)},title:(e.tags||[]).join(" ")},o.a.createElement("i",{className:"fa fa-key","aria-hidden":"true"}))),-1===l.state.editElementList.indexOf(t)?u.push(o.a.createElement(ra,{key:t,coin:l.state.coin,element:e,index:t,cbEdit:l.editElement,cbRemove:l.removeElement,cbTags:function(e){return l.setElementTags(e,t)},isDraggable:l.state.sortRowsEnabled,cbOnDragStart:l.onDragStart,cbOnDragOver:l.onDragOver})):u.push(o.a.createElement(xt,{key:t,config:l.state.config,coin:l.state.coin,element:e,index:t,cbSave:l.saveElement,cbCancel:l.cancelEditElement,isDraggable:l.state.sortRowsEnabled,cbOnDragStart:l.onDragStart,cbOnDragOver:l.onDragOver}));break;case"secretQuestion":u.push(o.a.createElement(ka,{key:t,config:l.state.config,coin:l.state.coin,element:e,index:t,closeButon:!1,cbSave:l.saveElement,cbRemove:l.removeElement,cbCancel:l.cancelEditElement,cbTags:function(e){return l.setElementTags(e,t)},isDraggable:l.state.sortRowsEnabled,cbOnDragStart:l.onDragStart,cbOnDragOver:l.onDragOver}));break;case"file":-1===l.state.editElementList.indexOf(t)?u.push(o.a.createElement(xa,{key:t,coin:l.state.coin,element:e,index:t,cbEdit:l.editElement,cbRemove:l.removeElement,cbTags:function(e){return l.setElementTags(e,t)},isDraggable:l.state.sortRowsEnabled,cbOnDragStart:l.onDragStart,cbOnDragOver:l.onDragOver})):u.push(o.a.createElement(Lt,{key:t,coin:l.state.coin,element:e,index:t,cbSave:l.saveElement,cbCancel:l.cancelEditElement,isDraggable:l.state.sortRowsEnabled,cbOnDragStart:l.onDragStart,cbOnDragOver:l.onDragOver}));break;case"misc":-1===l.state.editElementList.indexOf(t)?u.push(o.a.createElement(La,{key:t,coin:l.state.coin,element:e,index:t,cbEdit:l.editElement,cbRemove:l.removeElement,cbTags:function(e){return l.setElementTags(e,t)},isDraggable:l.state.sortRowsEnabled,cbOnDragStart:l.onDragStart,cbOnDragOver:l.onDragOver})):u.push(o.a.createElement(Ut,{key:t,coin:l.state.coin,element:e,index:t,cbSave:l.saveElement,cbCancel:l.cancelEditElement,isDraggable:l.state.sortRowsEnabled,cbOnDragStart:l.onDragStart,cbOnDragOver:l.onDragOver}))}}));var m="btn btn-sm";return this.state.sortRowsEnabled?m+=" btn-primary":m+=" btn-secondary",o.a.createElement("div",{className:"col"},o.a.createElement("div",{className:"accordion",id:"coin-"+this.state.coin.name},o.a.createElement("div",{className:"accordion-item"},o.a.createElement("h2",{className:"accordion-header",id:"heading-"+this.state.coin.name},o.a.createElement("div",{className:"btn-toolbar justify-content-between",role:"toolbar","aria-label":"Toolbar with button groups"},o.a.createElement("div",{className:"btn-group",role:"group","aria-label":"First group"},o.a.createElement("button",{className:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse-"+this.state.coin.name,"aria-expanded":"false","aria-controls":"collapse-"+this.state.coin.name},e,this.state.coin.data.displayName)),o.a.createElement("div",{className:"input-group"},f))),o.a.createElement("div",{id:"collapse-"+this.state.coin.name,className:"accordion-collapse collapse","aria-labelledby":"heading-"+this.state.coin.name,"data-bs-parent":"#coin-"+this.state.coin.name},o.a.createElement("div",{className:"accordion-body"},o.a.createElement("div",{className:"mb-3",role:"group"},o.a.createElement("div",{className:"btn-group float-end",role:"group"},o.a.createElement("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:function(e){return l.state.cbEditHeader(l.state.coin.name,l.state.coin.data)},title:i.a.t("editCoinHeader")},o.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"})),o.a.createElement("button",{type:"button",className:m,onClick:function(e){return l.sortRows()},title:i.a.t("sortCoin")},o.a.createElement("i",{className:"fa fa-sort","aria-hidden":"true"})),o.a.createElement("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:this.exportCoin,title:i.a.t("exportCoin")},o.a.createElement("i",{className:"fa fa-cloud-download","aria-hidden":"true"})),o.a.createElement("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:this.addSecretElement,title:i.a.t("addSecretElement")},o.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"})),o.a.createElement("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:function(e){return l.state.cbRemoveCoin(l.state.coin.name,l.state.coin.data.displayName)},title:i.a.t("removeCoin")},o.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true"})))),"",t,a,n,o.a.createElement("div",{onDrop:this.onDrop,onDragOver:this.onDragOver},u)))),r,s,c))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e}}]),a}();function Za(e){return(Za="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function en(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tn(e,t){return(tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function an(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nn(e){return(nn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var on=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tn(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=nn(e);if(t){var o=nn(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==Za(t)&&"function"!=typeof t?an(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,safe:e.safe,safeContent:e.safeContent,filteredCoinList:e.safeContent[e.safe.name].unlockedCoinList,filter:"",coinEditMode:0,coinEditName:!1,coinEditContent:!1,removeCoinMessage:!1,filterTimeout:!1},n.editSafe=n.editSafe.bind(an(n)),n.unlockSafe=n.unlockSafe.bind(an(n)),n.unlockSafeCallback=n.unlockSafeCallback.bind(an(n)),n.removeSafe=n.removeSafe.bind(an(n)),n.removeSafeConfirm=n.removeSafeConfirm.bind(an(n)),n.lockSafe=n.lockSafe.bind(an(n)),n.changeFilter=n.changeFilter.bind(an(n)),n.addCoin=n.addCoin.bind(an(n)),n.editCoinHeader=n.editCoinHeader.bind(an(n)),n.manageSafe=n.manageSafe.bind(an(n)),n.removeCoin=n.removeCoin.bind(an(n)),n.removeCoinConfirm=n.removeCoinConfirm.bind(an(n)),n.coinSaveCallback=n.coinSaveCallback.bind(an(n)),n}return function(e,t,a){t&&en(e.prototype,t),a&&en(e,a)}(a,[{key:"editSafe",value:function(){v.sendMessage("App",{action:"editSafe",target:this.state.safe.name})}},{key:"unlockSafe",value:function(){new bootstrap.Modal(document.getElementById("modalUnlockSafe"),{keyboard:!1}).show()}},{key:"unlockSafeCallback",value:function(e,t,a,n,o){e&&(v.sendMessage("App",{action:"setSafeKey",target:this.state.safe,key:t,keepUnlocked:a,unlockKeyName:n,removeStorage:!1,masterkeyData:o}),$.snack("info",i.a.t("unlockedSafe"))),bootstrap.Modal.getOrCreateInstance(document.querySelector("#modalUnlockSafe")).hide()}},{key:"lockSafe",value:function(){v.sendMessage("App",{action:"setSafeKey",target:this.state.safe,key:!1,removeStorage:!0}),$.snack("info",i.a.t("lockedSafe"))}},{key:"removeSafe",value:function(){new bootstrap.Modal(document.getElementById("removeSafe"),{keyboard:!1}).show()}},{key:"removeSafeConfirm",value:function(e){var t=this;e&&w.request(this.state.config.safe_endpoint+"/"+this.state.safe.name,"DELETE").then((function(){v.sendMessage("App",{action:"removeSafe",safe:t.state.safe}),$.snack("info",i.a.t("messageRemoveSafe"))})).fail((function(){$.snack("warning",i.a.t("messageErrorSaveSafe"))})),bootstrap.Modal.getOrCreateInstance(document.querySelector("#removeSafe")).hide()}},{key:"changeFilter",value:function(e){var t=this;this.setState({filter:e.target.value},(function(){clearTimeout(t.state.filterTimeout),setTimeout((function(){var e=[];t.state.safeContent[t.state.safe.name].unlockedCoinList.forEach((function(a){a.data.displayName.toUpperCase().search(t.state.filter.toUpperCase())>-1&&e.push(a)})),t.setState({filteredCoinList:e})}),3e3)}))}},{key:"addCoin",value:function(){this.setState({name:!1,coinEditContent:{displayName:"",rows:[]}},(function(){new bootstrap.Modal(document.getElementById("modalCoinEdit"),{keyboard:!1}).show()}))}},{key:"editCoinHeader",value:function(e,t){this.setState({coinEditName:e,coinEditContent:t},(function(){new bootstrap.Modal(document.getElementById("modalCoinEdit"),{keyboard:!1}).show()}))}},{key:"removeCoin",value:function(e,t){this.setState({coinEditName:e,removeCoinMessage:i.a.t("removeCoinMessage",{name:t||e})},(function(){new bootstrap.Modal(document.getElementById("removeCoin"),{keyboard:!1}).show()}))}},{key:"removeCoinConfirm",value:function(e){var t=this;e&&w.request(this.state.config.safe_endpoint+"/"+this.state.safe.name+"/coin/"+this.state.coinEditName,"DELETE").then((function(){$.snack("info",i.a.t("messageSuccessCoinRemove")),v.sendMessage("App",{action:"removeCoin",target:t.state.safe,coin:t.state.coinEditName})})).fail((function(){$.snack("warning",i.a.t("messageErrorCoinRemove"))})),bootstrap.Modal.getOrCreateInstance(document.querySelector("#removeCoin")).hide()}},{key:"coinSaveCallback",value:function(e,t,a){var n=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=bootstrap.Modal.getOrCreateInstance(document.querySelector("#modalCoinEdit"));return r&&r.hide(),e?t?new b.a(a).setProtectedHeader({alg:this.state.safe.alg_type,enc:this.state.safe.enc_type,sign_thumb:this.state.config.sign_thumb}).encrypt(this.state.safeContent[this.state.safe.name].key).then((function(e){var r={name:t,data:e};return w.request(n.state.config.safe_endpoint+"/"+n.state.safe.name+"/coin/"+t,"PUT",r).then((function(){o&&$.snack("info",i.a.t("messageSuccessCoinSave")),v.sendMessage("App",{action:"updateCoin",target:n.state.safe,encCoin:r,unlockedCoin:{name:t,data:a}})})).fail((function(){o&&$.snack("warning",i.a.t("messageErrorCoinSave"))}))})):new b.a(a).setProtectedHeader({alg:this.state.safe.alg_type,enc:this.state.safe.enc_type,sign_thumb:this.state.config.sign_thumb}).encrypt(this.state.safeContent[this.state.safe.name].key).then((function(e){var t={name:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),data:e};return w.request(n.state.config.safe_endpoint+"/"+n.state.safe.name+"/coin","POST",t).then((function(){o&&$.snack("info",i.a.t("messageSuccessCoinSave")),v.sendMessage("App",{action:"updateCoin",target:n.state.safe,encCoin:t,unlockedCoin:{name:t.name,data:a},cb:n.scrollToCoin})})).fail((function(){o&&$.snack("warning",i.a.t("messageErrorCoinSave"))}))})):Promise.reject("No can do")}},{key:"scrollToCoin",value:function(e){document.getElementById("coin-"+e).scrollIntoView()}},{key:"manageSafe",value:function(){new bootstrap.Modal(document.getElementById("manageSafe"),{keyboard:!1}).show()}},{key:"manageSafeClose",value:function(){bootstrap.Modal.getOrCreateInstance(document.querySelector("#manageSafe")).hide()}},{key:"render",value:function(){var e,t,a=this,n=[],r=this.state.safe&&this.state.safeContent&&this.state.safeContent[this.state.safe.name]&&this.state.safeContent[this.state.safe.name].key;return this.state.safe&&this.state.safeContent&&this.state.safeContent[this.state.safe.name]&&this.state.safeContent[this.state.safe.name].key?(e=o.a.createElement("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:this.lockSafe,title:i.a.t("safeLock")},o.a.createElement("i",{className:"fa fa-lock","aria-hidden":"true"})),t=o.a.createElement("div",{className:"mb-3"},o.a.createElement("form",null,o.a.createElement("input",{type:"text",className:"form-control",autoComplete:"off",placeholder:i.a.t("secretFilter"),id:"coinFilter",name:"coinFilter",value:this.state.filter,onChange:this.changeFilter})))):e=o.a.createElement("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:this.unlockSafe,title:i.a.t("safeUnlock")},o.a.createElement("i",{className:"fa fa-unlock","aria-hidden":"true"})),r&&this.state.filteredCoinList.forEach((function(e,t){n.push(o.a.createElement(Ya,{config:a.state.config,coin:e,safe:a.state.safe,cbEditHeader:a.editCoinHeader,cbRemoveCoin:a.removeCoin,cbSaveCoin:a.coinSaveCallback,key:t}))})),o.a.createElement("div",null,o.a.createElement("div",{className:"alert alert-primary text-center",role:"alert"},this.state.safe.display_name||this.state.safe.name,o.a.createElement("div",{className:"btn-group float-end",role:"group"},e,o.a.createElement("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:this.editSafe,disabled:!r,title:i.a.t("editSafe")},o.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"})),o.a.createElement("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:this.manageSafe,disabled:!r,title:i.a.t("manageSafe")},o.a.createElement("i",{className:"fa fa-cogs","aria-hidden":"true"})),o.a.createElement("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:this.addCoin,disabled:!r,title:i.a.t("addCoin")},o.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"})),o.a.createElement("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:function(e){return a.removeSafe()},disabled:!r,title:i.a.t("removeSafe")},o.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true"})))),t,o.a.createElement("div",{className:"row row-cols-1 row-cols-sm-1 row-cols-md-1 row-cols-lg-2"},n),o.a.createElement(Ke,{config:this.state.config,safe:this.state.safe,safeContent:this.state.safeContent,allowKeepUnlocked:!0,cb:this.unlockSafeCallback}),o.a.createElement(Ge,{editMode:this.state.coinEditMode,name:this.state.coinEditName,content:this.state.coinEditContent,cb:this.coinSaveCallback}),o.a.createElement(rt,{config:this.state.config,safe:this.state.safe,safeContent:this.state.safeContent,cbSaveCoin:this.coinSaveCallback,cbClose:this.manageSafeClose}),o.a.createElement(Z,{name:"removeSafe",title:i.a.t("removeSafeTitle"),message:i.a.t("removeSafeMessage",{name:this.state.safe.display_name||this.state.safe.name}),cb:this.removeSafeConfirm}),o.a.createElement(Z,{name:"removeCoin",title:i.a.t("removeCoinTitle"),message:this.state.removeCoinMessage,cb:this.removeCoinConfirm}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=Object.assign({},e);return a.filteredCoinList=e.safeContent[e.safe.name].unlockedCoinList,a.filter="",a}}]),a}();function rn(e){return(rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sn(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function cn(e,t){return(cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ln(e){return(ln=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var un=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cn(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=ln(e);if(t){var o=ln(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==rn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a)}}(a);function a(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),n=t.call(this,e);var o=e.editMode;return!e.editMode&&e.safeContent&&e.safe&&e.safeContent[e.safe.name]&&!e.safeContent[e.safe.name].keyList.length&&(o=2),n.state={config:e.config,hutchProfile:e.hutchProfile,safe:e.safe,safeContent:e.safeContent,editMode:o},n}return function(e,t,a){t&&sn(e.prototype,t),a&&sn(e,a)}(a,[{key:"render",value:function(){var e=this.state.safe&&this.state.safeContent&&this.state.safeContent[this.state.safe.name]&&this.state.safeContent[this.state.safe.name].keyList.length;return!this.state.editMode&&e?o.a.createElement(on,{config:this.state.config,safe:this.state.safe,safeContent:this.state.safeContent}):o.a.createElement(Be,{config:this.state.config,safe:this.state.safe,safeContent:this.state.safeContent,editMode:this.state.editMode})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=Object.assign({},e);return!e.editMode&&e.safeContent&&e.safe&&e.safeContent[e.safe.name]&&!e.safeContent[e.safe.name].keyList.length&&(a.editMode=2),a}}]),a}();function fn(e){return(fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mn(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function dn(e,t){return(dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hn(e){return(hn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var bn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dn(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=hn(e);if(t){var o=hn(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==fn(t)&&"function"!=typeof t?pn(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={config:e.config,profile:!1,hutchProfile:!1,hasProfile:!1,safeList:[],safeContent:{},curSafe:!1,addSafe:!1,oidcStatus:"connecting",nav:"profile",langChanged:!1,editProfile:!1,editSafeMode:0,trustworthy:!0,forceTrust:!1},k.addChangeRouteCallback((function(e){n.gotoRoute(e)})),v.subscribe("OIDC",(function(e){"disconnected"===e.status?(n.setState({oidcStatus:e.status,safeList:[],safeContent:{},curSafe:!1}),$.snack("warning",i.a.t("messageDisconnected"))):"connected"===e.status||"refresh"===e.status?(w.setToken(e.token),n.setState({oidcStatus:e.status}),"connected"===e.status&&$.snack("info",i.a.t("messageConnected"))):"profile"===e.status&&n.setState({profile:e.token},(function(){n.getHutchProfile().then((function(){n.getSafeList().then((function(){n.gotoRoute(k.getCurrentRoute())}))}))})),n.setForceTrust=n.setForceTrust.bind(pn(n))})),v.subscribe("App",(function(e){if("lang"===e.action)e.lang!==i.a.language&&i.a.changeLanguage(e.lang).then((function(){w.request("words-"+i.a.language+".json").then((function(e){var t=n.state.config;t.wordsList=e,n.setState({config:t})}))}));else if("editProfile"===e.action){var t=n.state.hutchProfile||{name:n.state.profile.name,message:"",picture:"",sign_kid:n.state.config.jwks.keys[0].kid};n.setState({nav:"profile",editProfile:!0,hutchProfile:t})}else if("getProfile"===e.action)n.setState({nav:"profile",editProfile:!1},(function(){n.getHutchProfile()}));else if("resetProfile"===e.action)n.setState({nav:"profile",editProfile:!1,hutchProfile:!1,hasProfile:!1,safeList:[],safeContent:{},curSafe:!1});else if("nav"===e.action)e.target?n.state.safeList.forEach((function(t){t.name===e.target&&n.setState({nav:"safe",curSafe:t,editSafeMode:0})})):n.setState({nav:"profile",editProfile:!1});else if("addSafe"===e.action)n.setState({nav:"safe",curSafe:{name:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),display_name:"",enc_type:"A256GCM",alg_type:"A256GCMKW"},editSafeMode:1});else if("editSafe"===e.action)n.state.safeList.forEach((function(t){t.name===e.target&&n.setState({nav:"safe",curSafe:t,editSafeMode:2})}));else if("saveSafe"===e.action){var a=n.state.safeList,o=n.state.safeContent,r=!1;a.forEach((function(t,n){t.name===e.safe.name&&(a[n]=e.safe,r=!0)})),r||(a.push(e.safe),o[e.safe.name]={keyList:[],coinList:[],unlockedCoinList:[],key:!1}),k.addRoute(e.safe.name),n.setState({safeList:a,safeContent:o,nav:"safe",curSafe:e.safe,editSafeMode:0})}else if("removeSafe"===e.action)a=n.state.safeList,o=n.state.safeContent,a.forEach((function(t,n){t.name===e.safe.name&&a.splice(n,1)})),k.addRoute(""),delete o[e.safe.name],n.setState({safeList:a,safeContent:o,nav:"profile",editProfile:!1});else if("updateSafeKey"===e.action)n.getSafeKeyList(e.safe.name).then((function(){n.setState({nav:"safe",curSafe:e.safe,editSafeMode:2})}));else if("setSafeKey"===e.action){if(!(o=n.state.safeContent)[e.target.name].key&&e.key&&(o[e.target.name].key=e.key),o[e.target.name].extractableKey=e.masterkeyData,o[e.target.name].lastUnlock=e.key?Date.now()/1e3:0,e.key){if(e.keepUnlocked){var s="A128KW";"A192KW"===e.target.alg_type||"A192GCMKW"===e.target.alg_type||"PBES2-HS384+A192KW"===e.target.alg_type?s="A192KW":"A256KW"!==e.target.alg_type&&"A256GCMKW"!==e.target.alg_type&&"PBES2-HS512+A256KW"!==e.target.alg_type||(s="A256KW"),Object(p.a)(s,{extractable:!0}).then((function(t){var a=Math.random().toString(36).substring(7);new b.a(e.masterkeyData).setProtectedHeader({alg:s,enc:e.target.enc_type,sign_key:n.state.config.sign_thumb,kid:a}).encrypt(t).then((function(o){var r={name:a,display_name:e.unlockKeyName,type:"browser",data:o},i=n.state.safeContent;i[e.target.name].keyList.push(r),n.setState({safeContent:i}),w.request(n.state.config.safe_endpoint+"/"+e.target.name+"/key","POST",r).then((function(){Object(h.a)(t).then((function(t){t.kid=a,t.alg=s;var n="hutchsafe-"+e.target.name;"/"!==window.location.pathname&&(n+="-"+window.btoa(unescape(encodeURIComponent(window.location.pathname))).replace(/\=+$/m,"")),P.setValue(n,t)}))}))}))}))}}else if(e.removeStorage){var c="hutchsafe-"+e.target.name;"/"!==window.location.pathname&&(c+="-"+window.btoa(unescape(encodeURIComponent(window.location.pathname))).replace(/\=+$/m,""));var l=P.getValue(c);l&&w.request(n.state.config.safe_endpoint+"/"+e.target.name+"/key/"+l.kid,"DELETE").then((function(){var t=n.state.safeContent;t[e.target.name].keyList.forEach((function(a,n){a.name===l.kid&&t[e.target.name].keyList.splice(n,1)})),n.setState({safeContent:t})})).fail((function(e){$.snack("danger",i.a.t("messageErrorSaveSafeKey"))})),P.removeValue(c),o[e.target.name].key=!1,o[e.target.name].extractableKey=!1,o[e.target.name].lastUnlock=0}n.setState({safeContent:o},(function(){n.unlockCoinList(e.target.name),n.state.safeContent[e.target.name].extractableKey&&setTimeout((function(){var t=n.state.safeContent;delete t[e.target.name].extractableKey,n.setState({safeContent:t},(function(){}))}),6e5)}))}else if("unlockSafe"===e.action)(o=n.state.safeContent)[e.safe.name].extractableKey=e.extractableKey,n.setState({safeContent:o},(function(){setTimeout((function(){var t=n.state.safeContent;delete t[e.safe.name].extractableKey,n.setState({safeContent:t},(function(){}))}),6e5),o[e.safe.name].unlockedCoinList.length!==o[e.safe.name].coinList.length&&n.unlockCoinList(e.safe.name)}));else if("lockAllSafe"===e.action)n.state.safeList.forEach((function(e){v.sendMessage("App",{action:"setSafeKey",target:e,removeStorage:!0,key:!1})}));else if("updateCoin"===e.action){var u=!1;(o=n.state.safeContent)[e.target.name].coinList.forEach((function(t,a){t.name===e.encCoin.name&&(o[e.target.name].coinList[a]=e.encCoin,u=!0)})),u?o[e.target.name].unlockedCoinList.forEach((function(t,a){t.name===e.unlockedCoin.name&&(o[e.target.name].unlockedCoinList[a]=e.unlockedCoin)})):(o[e.target.name].coinList.push(e.encCoin),o[e.target.name].unlockedCoinList.push(e.unlockedCoin)),o[e.target.name].unlockedCoinList.sort(n.compareCoin),n.setState({safeContent:o},(function(){e.cb&&e.cb(e.encCoin.name)}))}else"removeCoin"===e.action&&((o=n.state.safeContent)[e.target.name].coinList.forEach((function(t,a){t.name===e.coin&&delete o[e.target.name].coinList[a]})),o[e.target.name].unlockedCoinList.forEach((function(t,a){t.name===e.coin&&delete o[e.target.name].unlockedCoinList[a]})),n.setState({safeContent:o}))})),w.request("words-"+i.a.language+".json").then((function(e){var t=n.state.config;t.wordsList=e,n.setState({config:t})})),n.getHutchProfile=n.getHutchProfile.bind(pn(n)),n.getSafeList=n.getSafeList.bind(pn(n)),n.getSafeKeyList=n.getSafeKeyList.bind(pn(n)),n.unlockCoinList=n.unlockCoinList.bind(pn(n)),n.gotoRoute=n.gotoRoute.bind(pn(n)),n}return function(e,t,a){t&&mn(e.prototype,t)}(a,[{key:"gotoRoute",value:function(e){var t=this;e?this.state.safeList.forEach((function(a){a.name===e&&t.setState({nav:"safe",curSafe:a,editSafeMode:0})})):this.setState({nav:"profile",editProfile:!1})}},{key:"getHutchProfile",value:function(){var e=this;return w.request(this.state.config.profile_endpoint).then((function(t){var a=JSON.parse(atob(t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))),n=!1;if(e.state.config.jwks.keys.forEach((function(o){o.kid===a.sign_kid&&(n=!0,Object(f.a)(o,o.alg).then((function(a){Object(d.a)(o).then((function(n){Object(m.a)(t,a).then((function(t){w.setSignJwk(a);var o=e.state.config;o.sign_thumb=n,e.setState({config:o,hutchProfile:t.payload,hasProfile:!0})}))}))})))})),!n)return Promise.reject("invalid sign key")})).fail((function(t){404===t.status&&($.snack("info",i.a.t("messageNoProfile")),e.setState({hutchProfile:!1,hasProfile:!1}))}))}},{key:"getSafeList",value:function(){var e=this;return w.requestSigned(this.state.config.safe_endpoint).then((function(t){return e.setState({safeList:t.payload.list,trustworthy:!0},(function(){e.state.safeList.forEach((function(t){return w.requestSigned(e.state.config.safe_endpoint+"/"+t.name+"/key").then((function(a){return w.requestSigned(e.state.config.safe_endpoint+"/"+t.name+"/coin").then((function(n){var o=!0;n.payload.list.forEach((function(t){JSON.parse(atob(t.data.split(".")[0].replace(/-/g,"+").replace(/_/g,"/"))).sign_thumb!==e.state.config.sign_thumb&&(o=!1)}));var r=e.state.safeContent;r[t.name]={keyList:a.payload.list,coinList:n.payload.list,unlockedCoinList:[],key:!1,lastUnlock:0},e.setState({safeContent:r,trustworthy:e.state.trustworthy&&o},(function(){var n="hutchsafe-"+t.name;"/"!==window.location.pathname&&(n+="-"+window.btoa(unescape(encodeURIComponent(window.location.pathname))).replace(/\=+$/m,""));var o=P.getValue(n);o&&a.payload.list.forEach((function(a){a.name===o.kid&&Object(f.a)(o,o.alg).then((function(n){Object(y.a)(a.data,n).then((function(a){Object(f.a)(a.payload,t.alg_type).then((function(a){var n=e.state.safeContent;n[t.name].key=a,e.setState({safeContent:n},(function(){e.unlockCoinList(t.name)}))}))}))}))}))}))})).fail((function(t){console.log(t),$.snack("warning",i.a.t("messageErrorCoinList")),e.setState({hutchProfile:!1,hasProfile:!1,safeList:[],safeContent:{}})}))})).fail((function(t){console.log(t),$.snack("warning",i.a.t("messageErrorKeyList")),e.setState({hutchProfile:!1,hasProfile:!1,safeList:[],safeContent:{}})}))}))}))})).fail((function(t){console.log(t),$.snack("warning",i.a.t("messageErrorSafeList")),e.setState({hutchProfile:!1,hasProfile:!1,safeList:[],safeContent:{}})}))}},{key:"compareCoin",value:function(e,t){return e.data.displayName<t.data.displayName?-1:e.data.displayName>t.data.displayName?1:0}},{key:"unlockCoinList",value:function(e){var t=this,a=this.state.safeContent,n=a[e].key;n?a[e].coinList.forEach((function(o,r){Object(y.a)(o.data,n).then((function(n){a[e].unlockedCoinList.push({name:o.name,data:n.payload}),r===a[e].coinList.length-1&&(a[e].unlockedCoinList.sort(t.compareCoin),t.setState({safeContent:a}))}))})):(a[e].unlockedCoinList=[],this.setState({safeContent:a}))}},{key:"getSafeKeyList",value:function(e){var t=this;return w.requestSigned(this.state.config.safe_endpoint+"/"+e+"/key").then((function(a){var n=t.state.safeContent;n[e].keyList=a.payload.list,t.setState({safeContent:n})})).fail((function(e){$.snack("warning",i.a.t("messageErrorKeyList"))}))}},{key:"setForceTrust",value:function(){this.setState({forceTrust:!0})}},{key:"render",value:function(){var e,t,a,n=[];return(this.state.trustworthy||!this.state.trustworthy&&this.state.forceTrust)&&(n=this.state.safeList,"profile"===this.state.nav?e=o.a.createElement(he,{config:this.state.config,profile:this.state.profile,hutchProfile:this.state.hutchProfile,hasProfile:this.state.hasProfile,editProfile:this.state.editProfile,oidcStatus:this.state.oidcStatus}):"safe"===this.state.nav&&(e=o.a.createElement(un,{config:this.state.config,hutchProfile:this.state.hutchProfile,safe:this.state.curSafe,safeContent:this.state.safeContent,editMode:this.state.editSafeMode}))),this.state.trustworthy||(this.state.forceTrust||(a=o.a.createElement("div",null,o.a.createElement("div",null,i.a.t("untrustworthyOpenMessage")),o.a.createElement("div",null,o.a.createElement("button",{type:"button",className:"btn btn-secondary",onClick:this.setForceTrust},i.a.t("untrustworthyOpen"))))),t=o.a.createElement("div",{className:"alert alert-danger text-center",role:"alert"},i.a.t("untrustworthySafe"),a)),o.a.createElement("div",{className:"container-fluid"},o.a.createElement(q,{config:this.state.config,oidcStatus:this.state.oidcStatus,safeList:n}),t,e)}}]),a}();function yn(e){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gn(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vn(e,t){return(vn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function En(e){return(En=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var wn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vn(e,t)}(a,n.Component);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=En(e);if(t){var o=En(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return function(e,t){return!t||"object"!==yn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,a)}}(a);function a(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=t.call(this,e)).state={message:e.message},n}return function(e,t,a){t&&gn(e.prototype,t)}(a,[{key:"render",value:function(){return o.a.createElement("div",{className:"alert alert-danger perfect-centering",role:"alert"},o.a.createElement("h4",null,"Configuration error"),o.a.createElement("span",null,this.state.message))}}]),a}();try{i.a.use(l.a).use(u.a).init({fallbackLng:"en",ns:["translations"],defaultNS:"translations",backend:{loadPath:"locales/{{lng}}/{{ns}}.json"}}).then((function(){$.toastDefaults.position="top-right",$.toastDefaults.dismissible=!0,$.toastDefaults.stackable=!0,$.toastDefaults.pauseDelayOnHover=!0,new URLSearchParams(window.location.search),w.request("config.json").then((function(e){e.lang||(e.lang=["en","fr"]),P.setStorageType(e.storageType),function(e){var t={};return w.request(e+"/.well-known/hutch-configuration","GET",!1,"application/jwt").then((function(e){return JSON.parse(atob(e.split(".")[0].replace(/-/g,"+").replace(/_/g,"/"))),t.config=JSON.parse(atob(e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))),w.request(t.config.jwks_uri,"GET",!1,"application/jwt").then((function(a){return JSON.parse(atob(a.split(".")[0].replace(/-/g,"+").replace(/_/g,"/"))),t.jwks=JSON.parse(atob(a.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))),Object(f.a)(t.jwks.keys[0],t.jwks.keys[0].alg).then((function(n){return Object(m.a)(e,n).then((function(){return Object(m.a)(a,n).then((function(){return t}))}))}))}))}))}(e.hutchRootUrl).then((function(t){var a={oidc:{status:"connecting"},frontend:e,backend:t.config,jwks:t.jwks,profile_endpoint:e.profile_endpoint||t.config.profile_endpoint,safe_endpoint:e.safe_endpoint||t.config.safe_endpoint,oidc_server_remote_config:e.oidc.oidc_server_remote_config||t.config.oidc_server_remote_config,scope:e.oidc.scope||t.config.scope};L.init({storageType:P.storageType,responseType:e.oidc.responseType,openidConfigUrl:a.oidc_server_remote_config,authUrl:e.oidc.authUrl,tokenUrl:e.oidc.tokenUrl,clientId:e.oidc.clientId,redirectUri:e.oidc.redirectUri,scope:a.scope,userinfoUrl:e.oidc.userinfoUrl,changeStatusCb:function(e,t,a){v.sendMessage("OIDC",{status:e,token:t,expiration:a})}}),w.setConfig(e.APIUrl),s.a.render(o.a.createElement(bn,{config:a}),document.getElementById("root"))})).fail((function(e){s.a.render(o.a.createElement(wn,{message:"Error getting hutch backend config"}),document.getElementById("root"))}))})).fail((function(e){s.a.render(o.a.createElement(wn,{message:"Error getting hutch frontend config"}),document.getElementById("root"))}))}))}catch(e){$("#root").html('<div class="alert alert-danger" role="alert"><i class="fas fa-exclamation-triangle"></i><span class="btn-icon-right">You must use a browser compatible with Glewlwyd SSO</span></div>')}}})}));